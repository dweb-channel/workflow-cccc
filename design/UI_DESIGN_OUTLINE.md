# UI è®¾è®¡ç¨¿å¤§çº² - åŠ¨æ€å·¥ä½œæµç¼–è¾‘å™¨

**ç‰ˆæœ¬**: Draft v0.1
**åˆ›å»ºæ—¥æœŸ**: 2026-01-31
**ä½œè€…**: code-simplifier (å‰ç«¯ä¸“å®¶)
**çŠ¶æ€**: ç­‰å¾…å·¥å…·ç¡®è®¤ï¼ˆpencli æˆ– Markdownï¼‰

---

## è®¾è®¡ç›®æ ‡

åŸºäº DESIGN_SUPPLEMENT.md å’Œå›¢é˜Ÿå…±è¯†ï¼Œè®¾è®¡ä¸€ä¸ª**å·¥ç¨‹çº§**çš„åŠ¨æ€å·¥ä½œæµç¼–è¾‘å™¨ UIï¼Œæ ¸å¿ƒç‰¹æ€§ï¼š

1. **3-tier éªŒè¯ç­–ç•¥å¯è§†åŒ–**ï¼šå®æ—¶éªŒè¯ã€ä¿å­˜éªŒè¯ã€è¿è¡ŒéªŒè¯
2. **4-çŠ¶æ€å·¥ä½œæµæ¨¡å‹**ï¼šdraft â†” invalid_draft â†’ published â†’ archived
3. **å¯æ“ä½œçš„é”™è¯¯æç¤º**ï¼šå°†éªŒè¯é”™è¯¯è½¬åŒ–ä¸ºç”¨æˆ·å¼•å¯¼æ“ä½œ
4. **é›¶é˜²å¾¡æ€§æ£€æŸ¥**ï¼šåŸºäºåç«¯ context å­—æ®µå¥‘çº¦ç›´æ¥æ¸²æŸ“ UI

---

## ä¸€ã€èŠ‚ç‚¹å·¥å…·æ ï¼ˆNode Paletteï¼‰

### 1.1 å¸ƒå±€è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ èŠ‚ç‚¹å·¥å…·æ  (Node Palette)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ ã€æ‰§è¡Œå™¨ Executorsã€‘                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚ â”‚ LLM  â”‚  â”‚ CCCC â”‚                 â”‚
â”‚ â”‚ Agentâ”‚  â”‚ Peer â”‚                 â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                     â”‚
â”‚ ã€æ¡ä»¶ Conditionsã€‘                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚ â”‚ If/  â”‚                            â”‚
â”‚ â”‚ Else â”‚                            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                     â”‚
â”‚ ã€å·¥å…· Toolsã€‘                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚ â”‚Scriptâ”‚                            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 èŠ‚ç‚¹å¡ç‰‡çŠ¶æ€

**1. é»˜è®¤çŠ¶æ€ (Idle)**
- è¾¹æ¡†: `border-gray-300`
- èƒŒæ™¯: `bg-white`
- å›¾æ ‡: èŠ‚ç‚¹ç±»å‹å›¾æ ‡ï¼ˆğŸ¤– LLM / ğŸ‘¥ CCCC / ğŸ”€ Conditionalï¼‰
- æ–‡æœ¬: èŠ‚ç‚¹ç±»å‹åç§°

**2. æ‚¬åœçŠ¶æ€ (Hover)**
- è¾¹æ¡†: `border-blue-500`
- èƒŒæ™¯: `bg-blue-50`
- é˜´å½±: `shadow-md`
- æç¤º: æ˜¾ç¤ºèŠ‚ç‚¹æè¿°ï¼ˆtooltipï¼‰

**3. æ‹–æ‹½ä¸­ (Dragging)**
- é€æ˜åº¦: `opacity-50`
- è¾¹æ¡†: `border-blue-600 border-dashed`
- å…‰æ ‡: `cursor-grabbing`

**4. æ‹–æ‹½ç›®æ ‡åŒº (Drop Target)**
- ç”»å¸ƒæ˜¾ç¤ºè™šçº¿å ä½æ¡†
- èƒŒæ™¯: `bg-blue-100/30`
- æç¤ºæ–‡å­—: "é‡Šæ”¾ä»¥åˆ›å»ºèŠ‚ç‚¹"

### 1.3 èŠ‚ç‚¹ç±»å‹å…ƒæ•°æ®

```typescript
// components/NodePalette/nodeTypes.ts

export const NODE_TYPES_METADATA = [
  {
    id: 'llmAgent',
    category: 'executor',
    label: 'LLM Agent',
    icon: 'ğŸ¤–',
    description: 'ä½¿ç”¨ Claude æ‰§è¡Œ prompt',
    color: '#3b82f6', // blue-500
    defaultConfig: {
      prompt_template: '',
      input_fields: [],
      output_field: 'result',
      model: 'claude-opus-4-5'
    }
  },
  {
    id: 'ccccPeer',
    category: 'executor',
    label: 'CCCC Peer',
    icon: 'ğŸ‘¥',
    description: 'è°ƒç”¨ CCCC åä½œ peer',
    color: '#8b5cf6', // violet-500
    defaultConfig: {
      peer_id: '',
      command: [],
      prompt_template: '',
      timeout: 300
    }
  },
  {
    id: 'conditional',
    category: 'condition',
    label: 'Conditional',
    icon: 'ğŸ”€',
    description: 'æ¡ä»¶åˆ†æ”¯é€»è¾‘',
    color: '#f59e0b', // amber-500
    defaultConfig: {
      condition_type: 'field_exists',
      field: '',
      branches: ['true', 'false']
    }
  },
  {
    id: 'script',
    category: 'tool',
    label: 'Script',
    icon: 'âš™ï¸',
    description: 'æ‰§è¡Œè‡ªå®šä¹‰è„šæœ¬',
    color: '#10b981', // emerald-500
    defaultConfig: {
      script_type: 'python',
      code: '',
      input_fields: [],
      output_field: 'result'
    }
  }
];
```

---

## äºŒã€ç¼–è¾‘/æŸ¥çœ‹æ¨¡å¼åˆ‡æ¢

### 2.1 æ¨¡å¼åˆ‡æ¢ UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å·¥ä½œæµç¼–è¾‘å™¨                    [Edit] [View]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚          (React Flow Canvas)                â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åˆ‡æ¢æŒ‰é’®è®¾è®¡**ï¼š
- ä½ç½®: ç”»å¸ƒå³ä¸Šè§’
- æ ·å¼: Toggle button group (shadcn/ui)
- çŠ¶æ€æŒ‡ç¤º: å½“å‰æ¨¡å¼é«˜äº®æ˜¾ç¤º

### 2.2 æ¨¡å¼å·®å¼‚å¯¹æ¯”

| åŠŸèƒ½ | Edit æ¨¡å¼ | View æ¨¡å¼ |
|------|----------|-----------|
| èŠ‚ç‚¹æ‹–æ‹½ | âœ… å¯æ‹–æ‹½ | âŒ é”å®šä½ç½® |
| è¿çº¿åˆ›å»º | âœ… å¯è¿æ¥ | âŒ ä¸å¯è¿æ¥ |
| èŠ‚ç‚¹ç¼–è¾‘ | âœ… åŒå‡»é…ç½® | âŒ åªè¯»æŸ¥çœ‹ |
| èŠ‚ç‚¹åˆ é™¤ | âœ… å¯åˆ é™¤ | âŒ ä¸å¯åˆ é™¤ |
| å·¥å…·æ æ˜¾ç¤º | âœ… æ˜¾ç¤º | âŒ éšè— |
| ç”»å¸ƒäº¤äº’ | âœ… å¹³ç§»/ç¼©æ”¾ | âœ… å¹³ç§»/ç¼©æ”¾ |

### 2.3 çŠ¶æ€ç®¡ç†

```typescript
// hooks/useEditorMode.ts

type EditorMode = 'edit' | 'view';

export function useEditorMode() {
  const [mode, setMode] = useState<EditorMode>('edit');

  const editorConfig = useMemo(() => ({
    nodesDraggable: mode === 'edit',
    nodesConnectable: mode === 'edit',
    elementsSelectable: mode === 'edit',
    nodesFocusable: mode === 'edit',
    edgesFocusable: mode === 'edit'
  }), [mode]);

  return { mode, setMode, editorConfig };
}
```

---

## ä¸‰ã€éªŒè¯çŠ¶æ€ UIï¼ˆæ ¸å¿ƒï¼‰

### 3.1 çŠ¶æ€å¾½ç« ï¼ˆValidation Badgeï¼‰

**ä½ç½®**: ç”»å¸ƒå³ä¸Šè§’ï¼ˆæ¨¡å¼åˆ‡æ¢æŒ‰é’®æ—ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å·¥ä½œæµç¼–è¾‘å™¨        [ğŸŸ¢ å·²éªŒè¯]  [Edit] [View]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
```

**å¾½ç« çŠ¶æ€æ˜ å°„**ï¼š

| çŠ¶æ€ | å¾½ç«  | é¢œè‰² | æç¤ºæ–‡æœ¬ | å¯è¿è¡Œ |
|------|------|------|---------|--------|
| draft (æ— é”™è¯¯) | ğŸŸ¢ å·²éªŒè¯ | green-500 | "å·¥ä½œæµéªŒè¯é€šè¿‡ï¼Œå¯è¿è¡Œ" | âœ… |
| draft (æœ‰è­¦å‘Š) | ğŸŸ¡ æœ‰è­¦å‘Š | yellow-500 | "å·¥ä½œæµæœ‰ N ä¸ªè­¦å‘Šï¼Œä½†å¯è¿è¡Œ" | âœ… |
| invalid_draft | ğŸ”´ æœ‰é”™è¯¯ | red-500 | "å·¥ä½œæµæœ‰ N ä¸ªé”™è¯¯ï¼Œä¸å¯è¿è¡Œ" | âŒ |
| published | ğŸ”µ å·²å‘å¸ƒ | blue-500 | "å·¥ä½œæµå·²å‘å¸ƒï¼Œä¸å¯ç¼–è¾‘" | âœ… |
| archived | âš« å·²å½’æ¡£ | gray-500 | "å·¥ä½œæµå·²å½’æ¡£" | âŒ |

### 3.2 éªŒè¯è§¦å‘æ—¶æœº

**1. å®æ—¶éªŒè¯ï¼ˆEdit-timeï¼‰**
- è§¦å‘: èŠ‚ç‚¹/è¾¹å˜åŒ–å 500ms debounce
- éªŒè¯å†…å®¹: å¿«é€Ÿæ£€æŸ¥ï¼ˆç¯è·¯ã€å…¥å£ç‚¹ï¼‰
- UI åé¦ˆ: å¾½ç« é¢œè‰²å˜åŒ– + èŠ‚ç‚¹è¾¹æ¡†é«˜äº®

**2. ä¿å­˜éªŒè¯ï¼ˆSave-timeï¼‰**
- è§¦å‘: ç”¨æˆ·ç‚¹å‡»"ä¿å­˜"æŒ‰é’®
- éªŒè¯å†…å®¹: å®Œæ•´éªŒè¯ï¼ˆåŒ…æ‹¬å­—æ®µå¼•ç”¨ï¼‰
- API: `POST /api/workflows/{id}/validate`
- UI åé¦ˆ:
  - æœ‰é”™è¯¯ â†’ å¼¹å‡ºéªŒè¯å¯¹è¯æ¡†ï¼Œé˜»æ­¢ä¿å­˜
  - åªæœ‰è­¦å‘Š â†’ è¯¢é—®"ç¡®è®¤ä¿å­˜ï¼Ÿ"
  - æ— é—®é¢˜ â†’ ç›´æ¥ä¿å­˜

**3. è¿è¡ŒéªŒè¯ï¼ˆRun-timeï¼‰**
- è§¦å‘: ç”¨æˆ·ç‚¹å‡»"è¿è¡Œ"æŒ‰é’®
- éªŒè¯å†…å®¹: æ£€æŸ¥å·¥ä½œæµçŠ¶æ€ â‰  invalid_draft
- UI åé¦ˆ:
  - invalid_draft â†’ æ˜¾ç¤ºé”™è¯¯è¯¦æƒ…ï¼Œç¦ç”¨è¿è¡ŒæŒ‰é’®
  - å…¶ä»–çŠ¶æ€ â†’ å…è®¸è¿è¡Œ

### 3.3 èŠ‚ç‚¹é”™è¯¯é«˜äº®

**é”™è¯¯èŠ‚ç‚¹è¾¹æ¡†**ï¼š
```css
/* components/WorkflowNode.css */

.workflow-node--error {
  border: 2px solid theme('colors.red.500');
  box-shadow: 0 0 0 4px theme('colors.red.100');
  animation: pulse-error 2s infinite;
}

@keyframes pulse-error {
  0%, 100% {
    box-shadow: 0 0 0 4px theme('colors.red.100');
  }
  50% {
    box-shadow: 0 0 0 6px theme('colors.red.200');
  }
}
```

**è­¦å‘ŠèŠ‚ç‚¹è¾¹æ¡†**ï¼š
```css
.workflow-node--warning {
  border: 2px solid theme('colors.yellow.500');
  box-shadow: 0 0 0 4px theme('colors.yellow.100');
}
```

### 3.4 éªŒè¯å¯¹è¯æ¡†ï¼ˆValidation Dialogï¼‰

**è§¦å‘**: ä¿å­˜æ—¶æœ‰é”™è¯¯ OR ç‚¹å‡»å¾½ç« 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å·¥ä½œæµéªŒè¯ç»“æœ                          [Ã—]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚ âŒ å‘ç° 2 ä¸ªé”™è¯¯ï¼Œâš ï¸  1 ä¸ªè­¦å‘Š                  â”‚
â”‚                                                â”‚
â”‚ ã€é”™è¯¯ã€‘                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ”´ CIRCULAR_DEPENDENCY                     â”‚ â”‚
â”‚ â”‚    æ£€æµ‹åˆ°ç¯è·¯: node-1 â†’ node-2 â†’ node-1    â”‚ â”‚
â”‚ â”‚                                            â”‚ â”‚
â”‚ â”‚    å½±å“èŠ‚ç‚¹: [node-1] [node-2]             â”‚ â”‚
â”‚ â”‚                                            â”‚ â”‚
â”‚ â”‚    [æŸ¥çœ‹å¾ªç¯è·¯å¾„] [å»ºè®®åˆ é™¤è¾¹]              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ”´ MISSING_FIELD_REFERENCE                 â”‚ â”‚
â”‚ â”‚    èŠ‚ç‚¹ 'Peer1è§„åˆ’' å¼•ç”¨å­—æ®µ 'missing'     â”‚ â”‚
â”‚ â”‚    ä½†è¯¥å­—æ®µåœ¨å‰ç½®èŠ‚ç‚¹ä¸­æœªå®šä¹‰               â”‚ â”‚
â”‚ â”‚                                            â”‚ â”‚
â”‚ â”‚    å¯ç”¨å­—æ®µ: request, run_id, parsed       â”‚ â”‚
â”‚ â”‚                                            â”‚ â”‚
â”‚ â”‚    [é€‰æ‹©å­—æ®µ] [æŸ¥çœ‹å‰ç½®èŠ‚ç‚¹]                â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                â”‚
â”‚ ã€è­¦å‘Šã€‘                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ âš ï¸  NO_OUTGOING_EDGE                        â”‚ â”‚
â”‚ â”‚    èŠ‚ç‚¹ 'Peer2å®¡æ ¸' æ— å‡ºè¾¹ï¼ˆå¯èƒ½æ˜¯ç»ˆæ­¢èŠ‚ç‚¹ï¼‰â”‚ â”‚
â”‚ â”‚                                            â”‚ â”‚
â”‚ â”‚    [è¿æ¥åˆ°å…¶ä»–èŠ‚ç‚¹] [å¿½ç•¥]                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      [ä»ç„¶ä¿å­˜] [è¿”å›ä¿®å¤]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è®¾è®¡è¦ç‚¹**ï¼š
1. é”™è¯¯/è­¦å‘Šåˆ†ç»„æ˜¾ç¤º
2. æ¯ä¸ªé”™è¯¯å±•ç¤º context ä¿¡æ¯
3. å¯æ“ä½œæŒ‰é’®ï¼ˆåŸºäº error.codeï¼‰
4. ç‚¹å‡»é”™è¯¯é¡¹ â†’ ç”»å¸ƒæ»šåŠ¨åˆ°é”™è¯¯èŠ‚ç‚¹å¹¶é«˜äº®

---

## å››ã€èŠ‚ç‚¹é…ç½®é¢æ¿

### 4.1 é¢æ¿å¸ƒå±€

**ä½ç½®**: ç”»å¸ƒå³ä¾§æŠ½å±‰ï¼ˆDrawerï¼‰
**è§¦å‘**: åŒå‡»èŠ‚ç‚¹ OR é€‰ä¸­èŠ‚ç‚¹åç‚¹å‡»"é…ç½®"æŒ‰é’®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ èŠ‚ç‚¹é…ç½® - LLM Agent                    [Ã—]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚ ã€åŸºæœ¬ä¿¡æ¯ã€‘                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ èŠ‚ç‚¹æ ‡ç­¾                                   â”‚ â”‚
â”‚ â”‚ [Peer1_è§„åˆ’___________________]           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                â”‚
â”‚ ã€Prompt æ¨¡æ¿ã€‘                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ è¯·æ ¹æ®ç”¨æˆ·éœ€æ±‚ {request} åˆ¶å®šè¯¦ç»†è®¡åˆ’...    â”‚ â”‚
â”‚ â”‚                                            â”‚ â”‚
â”‚ â”‚ å‚è€ƒå·²æœ‰ä¿¡æ¯: {parsed_requirements}        â”‚ â”‚
â”‚ â”‚ â–¼                                          â”‚ â”‚
â”‚ â”‚                                            â”‚ â”‚
â”‚ â”‚ å¯ç”¨å­—æ®µ: {request} {run_id} {parsed}      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                â”‚
â”‚ ã€è¾“å…¥å­—æ®µã€‘                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ + request                            [Ã—]   â”‚ â”‚
â”‚ â”‚ + parsed_requirements                [Ã—]   â”‚ â”‚
â”‚ â”‚                                            â”‚ â”‚
â”‚ â”‚ [+ æ·»åŠ è¾“å…¥å­—æ®µ]                            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                â”‚
â”‚ ã€è¾“å‡ºå­—æ®µã€‘                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [plan_______________________________]      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                â”‚
â”‚ ã€é«˜çº§è®¾ç½®ã€‘                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ æ¨¡å‹: [claude-opus-4-5 â–¼]                  â”‚ â”‚
â”‚ â”‚ è¶…æ—¶: [300ç§’]                               â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                            [å–æ¶ˆ] [ä¿å­˜æ›´æ”¹]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å­—æ®µè‡ªåŠ¨è¡¥å…¨ï¼ˆField Autocompleteï¼‰

**è§¦å‘**: Prompt æ¨¡æ¿è¾“å…¥æ¡†ä¸­è¾“å…¥ `{`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¯·æ ¹æ®ç”¨æˆ·éœ€æ±‚ {|                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ å¯ç”¨å­—æ®µ:                             â”‚   â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚ â”‚ â”‚ âœ“ request                        â”‚ â”‚   â”‚
â”‚ â”‚ â”‚   run_id                         â”‚ â”‚   â”‚
â”‚ â”‚ â”‚   parsed_requirements            â”‚ â”‚   â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°**ï¼š
```typescript
// components/FieldAutocomplete.tsx

import { useQuery } from '@tanstack/react-query';

export function FieldAutocomplete({ nodeId, onSelect }) {
  const { data: upstreamFields } = useQuery({
    queryKey: ['upstreamFields', nodeId],
    queryFn: () => api.get(`/api/workflows/${wfId}/nodes/${nodeId}/upstream-fields`)
  });

  return (
    <Command>
      <CommandInput placeholder="è¾“å…¥å­—æ®µå..." />
      <CommandList>
        {upstreamFields.map(field => (
          <CommandItem onSelect={() => onSelect(field)}>
            {field}
          </CommandItem>
        ))}
      </CommandList>
    </Command>
  );
}
```

### 4.3 CCCC Peer é…ç½®é¢æ¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ èŠ‚ç‚¹é…ç½® - CCCC Peer                    [Ã—]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚ ã€åŸºæœ¬ä¿¡æ¯ã€‘                                    â”‚
â”‚ èŠ‚ç‚¹æ ‡ç­¾: [Peer_ä»£ç å®ç°_______________]        â”‚
â”‚                                                â”‚
â”‚ ã€Peer é…ç½®ã€‘                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Peer ID                                    â”‚ â”‚
â”‚ â”‚ [peer-impl_____________________________]   â”‚ â”‚
â”‚ â”‚                                            â”‚ â”‚
â”‚ â”‚ å‘½ä»¤ (å¯é€‰ï¼Œç•™ç©ºä½¿ç”¨é»˜è®¤)                   â”‚ â”‚
â”‚ â”‚ [claude___________________________] [+]    â”‚ â”‚
â”‚ â”‚                                            â”‚ â”‚
â”‚ â”‚ è¶…æ—¶æ—¶é—´ (ç§’)                               â”‚ â”‚
â”‚ â”‚ [300_________________________________]      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                â”‚
â”‚ ã€Prompt æ¨¡æ¿ã€‘                                 â”‚
â”‚ (åŒ LLM Agent)                                 â”‚
â”‚                                                â”‚
â”‚ ã€é«˜çº§è®¾ç½®ã€‘                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â˜‘ è¶…æ—¶åé‡è¯•                                â”‚ â”‚
â”‚ â”‚   é‡è¯•æ¬¡æ•°: [3]                             â”‚ â”‚
â”‚ â”‚                                            â”‚ â”‚
â”‚ â”‚ â˜‘ å¤±è´¥å Fallback åˆ° Claude CLI             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                            [å–æ¶ˆ] [ä¿å­˜æ›´æ”¹]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº”ã€å¯æ“ä½œçš„é”™è¯¯æç¤ºï¼ˆErrorActionableï¼‰

### 5.1 ç»„ä»¶è®¾è®¡

**æ ¸å¿ƒç†å¿µ**: å°†é”™è¯¯ä»"é˜»å¡"å˜ä¸º"å¼•å¯¼"

```tsx
// components/ErrorActionable.tsx

interface ErrorAction {
  label: string;
  icon?: React.ReactNode;
  onClick: () => void;
  variant?: 'default' | 'destructive' | 'outline';
}

interface ErrorActionableProps {
  error: ValidationError;
  onActionComplete?: () => void;
}

export function ErrorActionable({ error, onActionComplete }: ErrorActionableProps) {
  const actions = useErrorActions(error);

  return (
    <Alert variant={error.severity === 'error' ? 'destructive' : 'warning'}>
      <AlertCircle className="h-4 w-4" />
      <AlertTitle>{getErrorTitle(error.code)}</AlertTitle>
      <AlertDescription>
        {error.message}

        {/* Context ä¿¡æ¯å±•ç¤º */}
        {error.context && (
          <div className="mt-2 text-sm">
            {error.code === 'MISSING_FIELD_REFERENCE' && (
              <Popover>
                <PopoverTrigger asChild>
                  <Button variant="link" size="sm">
                    æŸ¥çœ‹å¯ç”¨å­—æ®µ ({error.context.available_fields.length})
                  </Button>
                </PopoverTrigger>
                <PopoverContent>
                  <div className="space-y-2">
                    {error.context.available_fields.map(field => (
                      <Button
                        key={field}
                        variant="outline"
                        size="sm"
                        onClick={() => actions.insertField(field)}
                      >
                        {field}
                      </Button>
                    ))}
                  </div>
                </PopoverContent>
              </Popover>
            )}
          </div>
        )}

        {/* æ“ä½œæŒ‰é’® */}
        {actions.length > 0 && (
          <div className="mt-3 flex gap-2">
            {actions.map((action, index) => (
              <Button
                key={index}
                variant={action.variant || 'default'}
                size="sm"
                onClick={() => {
                  action.onClick();
                  onActionComplete?.();
                }}
              >
                {action.icon}
                {action.label}
              </Button>
            ))}
          </div>
        )}
      </AlertDescription>
    </Alert>
  );
}
```

### 5.2 é”™è¯¯ç±»å‹ â†’ æ“ä½œæ˜ å°„

```typescript
// hooks/useErrorActions.ts

export function useErrorActions(error: ValidationError): ErrorAction[] {
  const { reactFlowInstance } = useWorkflowEditor();

  const actionMap: Record<string, (ctx: any) => ErrorAction[]> = {
    MISSING_FIELD_REFERENCE: (ctx) => [
      {
        label: 'é€‰æ‹©å¯ç”¨å­—æ®µ',
        icon: <Sparkles className="h-4 w-4 mr-1" />,
        onClick: () => openFieldPicker(ctx.available_fields)
      },
      {
        label: 'æŸ¥çœ‹å‰ç½®èŠ‚ç‚¹',
        icon: <Eye className="h-4 w-4 mr-1" />,
        onClick: () => highlightUpstreamNodes(ctx.upstream_node_ids),
        variant: 'outline'
      }
    ],

    CIRCULAR_DEPENDENCY: (ctx) => [
      {
        label: 'æŸ¥çœ‹å¾ªç¯è·¯å¾„',
        icon: <RotateCw className="h-4 w-4 mr-1" />,
        onClick: () => visualizeCycle(ctx.cycle_path)
      },
      {
        label: 'å»ºè®®åˆ é™¤è¾¹',
        icon: <Scissors className="h-4 w-4 mr-1" />,
        onClick: () => suggestEdgeToRemove(ctx.cycle_path),
        variant: 'destructive'
      }
    ],

    DANGLING_NODE: (ctx) => [
      {
        label: 'è¿æ¥åˆ°å…¶ä»–èŠ‚ç‚¹',
        icon: <Link className="h-4 w-4 mr-1" />,
        onClick: () => showConnectionSuggestions(ctx.node_ids)
      },
      {
        label: 'è®¾ä¸ºç»“æŸèŠ‚ç‚¹',
        icon: <Flag className="h-4 w-4 mr-1" />,
        onClick: () => addEndEdge(ctx.node_ids[0]),
        variant: 'outline'
      }
    ],

    NO_OUTGOING_EDGE: (ctx) => [
      {
        label: 'æ·»åŠ å‡ºè¾¹',
        icon: <ArrowRight className="h-4 w-4 mr-1" />,
        onClick: () => enterConnectionMode(ctx.node_id)
      },
      {
        label: 'å¿½ç•¥ï¼ˆç»ˆæ­¢èŠ‚ç‚¹ï¼‰',
        icon: <Check className="h-4 w-4 mr-1" />,
        onClick: () => markAsTerminal(ctx.node_id),
        variant: 'outline'
      }
    ]
  };

  const handler = actionMap[error.code];
  return handler ? handler(error.context || {}) : [];
}
```

---

## å…­ã€é…è‰²æ–¹æ¡ˆï¼ˆshadcn/ui é£æ ¼ï¼‰

### 6.1 ä¸»é¢˜è‰²

```css
/* app/globals.css */

:root {
  /* çŠ¶æ€é¢œè‰² */
  --color-success: 34 197 94;      /* green-500 */
  --color-warning: 234 179 8;      /* yellow-500 */
  --color-error: 239 68 68;        /* red-500 */
  --color-info: 59 130 246;        /* blue-500 */

  /* èŠ‚ç‚¹ç±»å‹é¢œè‰² */
  --color-node-llm: 59 130 246;    /* blue-500 */
  --color-node-cccc: 139 92 246;   /* violet-500 */
  --color-node-conditional: 245 158 11; /* amber-500 */
  --color-node-script: 16 185 129; /* emerald-500 */

  /* éªŒè¯çŠ¶æ€ */
  --color-validated: var(--color-success);
  --color-has-warnings: var(--color-warning);
  --color-has-errors: var(--color-error);
}
```

### 6.2 ç»„ä»¶æ ·å¼è§„èŒƒ

**æŒ‰é’®**:
- Primary: `bg-blue-600 hover:bg-blue-700`
- Destructive: `bg-red-600 hover:bg-red-700`
- Outline: `border-gray-300 hover:bg-gray-50`

**å¾½ç« **:
- Success: `bg-green-100 text-green-800 border-green-300`
- Warning: `bg-yellow-100 text-yellow-800 border-yellow-300`
- Error: `bg-red-100 text-red-800 border-red-300`

**å¯¹è¯æ¡†**:
- èƒŒæ™¯: `bg-white dark:bg-gray-900`
- è¾¹æ¡†: `border-gray-200 dark:border-gray-800`
- é˜´å½±: `shadow-2xl`

---

## ä¸ƒã€äº¤äº’æµç¨‹

### 7.1 åˆ›å»ºæ–°å·¥ä½œæµ

```
1. ç”¨æˆ·ç‚¹å‡»"æ–°å»ºå·¥ä½œæµ"
   â†“
2. æ˜¾ç¤ºç©ºç™½ç”»å¸ƒ + èŠ‚ç‚¹å·¥å…·æ 
   â†“
3. ç”¨æˆ·ä»å·¥å…·æ æ‹–æ‹½èŠ‚ç‚¹åˆ°ç”»å¸ƒ
   â†“
4. å®æ—¶éªŒè¯è§¦å‘ï¼ˆ500ms debounceï¼‰
   â†“
5. å¾½ç« æ›´æ–° + èŠ‚ç‚¹è¾¹æ¡†å˜è‰²ï¼ˆå¦‚æœ‰é”™è¯¯ï¼‰
   â†“
6. ç”¨æˆ·åŒå‡»èŠ‚ç‚¹é…ç½®
   â†“
7. é…ç½®é¢æ¿æ‰“å¼€ï¼ˆå³ä¾§æŠ½å±‰ï¼‰
   â†“
8. ç”¨æˆ·å¡«å†™ prompt æ¨¡æ¿ï¼Œä½¿ç”¨ {field} è‡ªåŠ¨è¡¥å…¨
   â†“
9. ä¿å­˜é…ç½® â†’ å†æ¬¡éªŒè¯
   â†“
10. ç”¨æˆ·è¿æ¥èŠ‚ç‚¹ï¼ˆæ‹–æ‹½è¾¹ï¼‰
    â†“
11. ç”¨æˆ·ç‚¹å‡»"ä¿å­˜"
    â†“
12. è§¦å‘ä¿å­˜éªŒè¯ï¼ˆPOST /validateï¼‰
    â†“
    â”œâ”€ æœ‰é”™è¯¯ â†’ å¼¹å‡ºéªŒè¯å¯¹è¯æ¡† â†’ ç”¨æˆ·ä¿®å¤
    â”œâ”€ æœ‰è­¦å‘Š â†’ è¯¢é—®"ç¡®è®¤ä¿å­˜ï¼Ÿ" â†’ ç”¨æˆ·ç¡®è®¤
    â””â”€ æ— é—®é¢˜ â†’ ä¿å­˜æˆåŠŸ â†’ æç¤º"å·¥ä½œæµå·²ä¿å­˜"
```

### 7.2 è¿è¡Œå·¥ä½œæµ

```
1. ç”¨æˆ·ç‚¹å‡»"è¿è¡Œ"æŒ‰é’®
   â†“
2. æ£€æŸ¥å·¥ä½œæµçŠ¶æ€
   â†“
   â”œâ”€ invalid_draft â†’ æ˜¾ç¤ºé”™è¯¯è¯¦æƒ…ï¼Œç¦ç”¨è¿è¡Œ
   â””â”€ å…¶ä»–çŠ¶æ€ â†’ å…è®¸è¿è¡Œ
       â†“
3. POST /api/workflows/{id}/run
   â†“
4. è·å– run_id
   â†“
5. å»ºç«‹ SSE è¿æ¥: GET /stream/{run_id}
   â†“
6. ç›‘å¬äº‹ä»¶:
   â”œâ”€ node_update â†’ æ›´æ–°èŠ‚ç‚¹çŠ¶æ€ï¼ˆrunning/completed/errorï¼‰
   â”œâ”€ node_output â†’ æ˜¾ç¤ºèŠ‚ç‚¹è¾“å‡ºï¼ˆå®æ—¶å±•ç¤ºï¼‰
   â”œâ”€ workflow_completed â†’ æ˜¾ç¤ºå®Œæˆæç¤º
   â””â”€ error â†’ æ˜¾ç¤ºé”™è¯¯å¯¹è¯æ¡†
```

### 7.3 é”™è¯¯ä¿®å¤æµç¨‹

```
1. éªŒè¯å¤±è´¥ â†’ å¼¹å‡ºéªŒè¯å¯¹è¯æ¡†
   â†“
2. ç”¨æˆ·ç‚¹å‡»é”™è¯¯é¡¹
   â†“
3. ç”»å¸ƒæ»šåŠ¨åˆ°é”™è¯¯èŠ‚ç‚¹å¹¶é«˜äº®
   â†“
4. ç”¨æˆ·ç‚¹å‡»"å¯æ“ä½œæŒ‰é’®"
   â†“
   ä¾‹å¦‚: MISSING_FIELD_REFERENCE
   â”œâ”€ ç‚¹å‡»"é€‰æ‹©å¯ç”¨å­—æ®µ"
   â”‚  â†“
   â”‚  æ‰“å¼€å­—æ®µé€‰æ‹©å™¨ï¼ˆPopoverï¼‰
   â”‚  â†“
   â”‚  ç”¨æˆ·ç‚¹å‡»å­—æ®µ â†’ è‡ªåŠ¨æ’å…¥åˆ° prompt æ¨¡æ¿
   â”‚
   â”œâ”€ ç‚¹å‡»"æŸ¥çœ‹å‰ç½®èŠ‚ç‚¹"
   â”‚  â†“
   â”‚  é«˜äº®æ‰€æœ‰ä¸Šæ¸¸èŠ‚ç‚¹
   â”‚  â†“
   â”‚  ç”»å¸ƒ fitView æ˜¾ç¤ºä¸Šæ¸¸èŠ‚ç‚¹
   â”‚
   â””â”€ ç”¨æˆ·æ‰‹åŠ¨ä¿®æ”¹ prompt æ¨¡æ¿
      â†“
5. ä¿å­˜é…ç½®
   â†“
6. å®æ—¶éªŒè¯è§¦å‘
   â†“
7. é”™è¯¯æ¶ˆå¤± â†’ å¾½ç« å˜ç»¿ âœ…
```

---

## å…«ã€å“åº”å¼è®¾è®¡

### 8.1 æ–­ç‚¹å®šä¹‰

```typescript
// lib/responsive.ts

export const BREAKPOINTS = {
  sm: 640,   // å°å±æ‰‹æœº
  md: 768,   // å¹³æ¿
  lg: 1024,  // ç¬”è®°æœ¬
  xl: 1280,  // æ¡Œé¢
  '2xl': 1536 // å¤§å±
};
```

### 8.2 å¸ƒå±€é€‚é…

**æ¡Œé¢ (â‰¥1024px)**:
- èŠ‚ç‚¹å·¥å…·æ : å·¦ä¾§å›ºå®šï¼Œå®½åº¦ 280px
- ç”»å¸ƒ: ä¸­é—´è‡ªé€‚åº”
- é…ç½®é¢æ¿: å³ä¾§æŠ½å±‰ï¼Œå®½åº¦ 400px

**å¹³æ¿ (768px - 1023px)**:
- èŠ‚ç‚¹å·¥å…·æ : é¡¶éƒ¨æ¨ªå‘å¸ƒå±€ï¼Œé«˜åº¦ 80px
- ç”»å¸ƒ: å…¨å®½
- é…ç½®é¢æ¿: å³ä¾§æŠ½å±‰ï¼Œå®½åº¦ 360px

**æ‰‹æœº (< 768px)**:
- èŠ‚ç‚¹å·¥å…·æ : åº•éƒ¨æµ®åŠ¨æŒ‰é’® + å…¨å±æŠ½å±‰
- ç”»å¸ƒ: å…¨å±
- é…ç½®é¢æ¿: å…¨å±æŠ½å±‰

---

## ä¹ã€æ€§èƒ½ä¼˜åŒ–

### 9.1 è™šæ‹ŸåŒ–æ¸²æŸ“

å¯¹äºå¤§å‹å·¥ä½œæµï¼ˆ>100 èŠ‚ç‚¹ï¼‰ï¼Œä½¿ç”¨ React Flow å†…ç½®çš„è™šæ‹ŸåŒ–ï¼š

```typescript
<ReactFlow
  nodes={nodes}
  edges={edges}
  onlyRenderVisibleElements={true} // åªæ¸²æŸ“å¯è§èŠ‚ç‚¹
  minZoom={0.1}
  maxZoom={4}
/>
```

### 9.2 é˜²æŠ–éªŒè¯

```typescript
// hooks/useValidation.ts

const debouncedValidate = useMemo(
  () => debounce(async (workflow) => {
    const result = await validateWorkflowClient(workflow);
    setValidationResult(result);
  }, 500),
  []
);
```

### 9.3 SSE æ–­ç‚¹ç»­ä¼ 

```typescript
// hooks/useSSE.ts

function useSSE(workflowId: string, runId: string) {
  const [lastEventId, setLastEventId] = useLocalStorage(
    `sse_${runId}_lastEventId`,
    ''
  );

  useEffect(() => {
    const url = `/api/workflows/${workflowId}/stream/${runId}${
      lastEventId ? `?lastEventId=${lastEventId}` : ''
    }`;

    const eventSource = new EventSource(url);

    eventSource.addEventListener('node_update', (event) => {
      setLastEventId(event.lastEventId);
      // ... å¤„ç†äº‹ä»¶
    });

    eventSource.onerror = () => {
      eventSource.close();
      // 3 ç§’åé‡è¿ï¼ˆä½¿ç”¨ lastEventId æ–­ç‚¹ç»­ä¼ ï¼‰
      setTimeout(() => /* reconnect */, 3000);
    };

    return () => eventSource.close();
  }, [workflowId, runId, lastEventId]);
}
```

---

## åã€æ— éšœç¢è®¾è®¡ï¼ˆAccessibilityï¼‰

### 10.1 é”®ç›˜å¯¼èˆª

- `Tab`: åœ¨èŠ‚ç‚¹é—´å¯¼èˆª
- `Enter`: æ‰“å¼€é€‰ä¸­èŠ‚ç‚¹çš„é…ç½®é¢æ¿
- `Delete`: åˆ é™¤é€‰ä¸­èŠ‚ç‚¹/è¾¹
- `Ctrl+Z`: æ’¤é”€
- `Ctrl+Shift+Z`: é‡åš
- `Ctrl+S`: ä¿å­˜å·¥ä½œæµ

### 10.2 ARIA æ ‡ç­¾

```tsx
<button
  aria-label="æ–°å»º LLM Agent èŠ‚ç‚¹"
  role="button"
  tabIndex={0}
>
  <NodeIcon />
  LLM Agent
</button>
```

### 10.3 é¢œè‰²å¯¹æ¯”åº¦

ç¡®ä¿æ‰€æœ‰æ–‡æœ¬ç¬¦åˆ WCAG AA æ ‡å‡†ï¼š
- æ­£å¸¸æ–‡æœ¬: å¯¹æ¯”åº¦ â‰¥ 4.5:1
- å¤§æ–‡æœ¬: å¯¹æ¯”åº¦ â‰¥ 3:1

---

## åä¸€ã€å¾…å·¥å…·ç¡®è®¤åå®Œæˆçš„è®¾è®¡ç¨¿

ä¸€æ—¦ç¡®è®¤ä½¿ç”¨ **pencli** æˆ–å…¶ä»–å·¥å…·ï¼Œå°†å®Œæˆä»¥ä¸‹è¯¦ç»†è®¾è®¡ç¨¿ï¼š

1. **èŠ‚ç‚¹å·¥å…·æ å®Œæ•´è®¾è®¡**
   - æ‰€æœ‰èŠ‚ç‚¹ç±»å‹å¡ç‰‡
   - æ‹–æ‹½çŠ¶æ€å˜åŒ–åŠ¨ç”»
   - åˆ†ç±»æŠ˜å /å±•å¼€äº¤äº’

2. **éªŒè¯å¯¹è¯æ¡†å®Œæ•´è®¾è®¡**
   - æ‰€æœ‰é”™è¯¯ç±»å‹çš„å±•ç¤ºæ ·å¼
   - å¯æ“ä½œæŒ‰é’®çš„å®Œæ•´äº¤äº’
   - æ»šåŠ¨é«˜äº®æ•ˆæœ

3. **èŠ‚ç‚¹é…ç½®é¢æ¿å®Œæ•´è®¾è®¡**
   - LLM Agent é…ç½®é¢æ¿
   - CCCC Peer é…ç½®é¢æ¿
   - Conditional é…ç½®é¢æ¿
   - Script é…ç½®é¢æ¿
   - å­—æ®µè‡ªåŠ¨è¡¥å…¨ç»„ä»¶

4. **ç”»å¸ƒäº¤äº’è®¾è®¡**
   - èŠ‚ç‚¹è¿æ¥åŠ¨ç”»
   - å®æ—¶éªŒè¯åé¦ˆ
   - é”™è¯¯é«˜äº®æ•ˆæœ

5. **çŠ¶æ€æµè½¬å›¾**
   - draft â†” invalid_draft â†” published â†” archived
   - æ‰€æœ‰çŠ¶æ€è½¬æ¢çš„ UI åé¦ˆ

---

## å½“å‰çŠ¶æ€

- âœ… è®¾è®¡å¤§çº²å®Œæˆ
- ğŸ”„ ç­‰å¾…å·¥å…·ç¡®è®¤ï¼ˆpencli æˆ– Markdownï¼‰
- â³ å›¢é˜Ÿå·²æ”¶åˆ° attention æ¶ˆæ¯ï¼Œç­‰å¾…å›å¤

ä¸€æ—¦å·¥å…·ç¡®è®¤ï¼Œé¢„è®¡ **1-2 å¤©å†…å®Œæˆè¯¦ç»†è®¾è®¡ç¨¿**ã€‚
