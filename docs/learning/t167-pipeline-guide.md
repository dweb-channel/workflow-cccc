# T167: Pipeline å®æ“æŒ‡å—

> ä½œè€…: browser-tester | ç›®æ ‡: è·Ÿç€åšä¸€éå°±èƒ½ç†è§£ä¸¤æ¡ç®¡çº¿çš„å®Œæ•´æµç¨‹

---

## ç›®å½•

- [ç¬¬ä¸€éƒ¨åˆ†: Batch Bug Fix ç®¡çº¿](#ç¬¬ä¸€éƒ¨åˆ†-batch-bug-fix-ç®¡çº¿)
- [ç¬¬äºŒéƒ¨åˆ†: Design-to-Spec ç®¡çº¿](#ç¬¬äºŒéƒ¨åˆ†-design-to-spec-ç®¡çº¿)
- [ç¬¬ä¸‰éƒ¨åˆ†: å¸¸è§é—®é¢˜æ’æŸ¥](#ç¬¬ä¸‰éƒ¨åˆ†-å¸¸è§é—®é¢˜æ’æŸ¥)

---

# ç¬¬ä¸€éƒ¨åˆ†: Batch Bug Fix ç®¡çº¿

## å‰ç½®æ¡ä»¶

å¯åŠ¨æœåŠ¡ï¼ˆäºŒé€‰ä¸€ï¼‰:

**æ–¹å¼ A: ä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰**
```bash
make dev   # è‡ªåŠ¨å¯åŠ¨ Temporal dev server + FastAPI + Temporal Worker + Next.js
```

**æ–¹å¼ B: åˆ†å¼€å¯åŠ¨**
```bash
# 1. Temporal Server â€” é€‰ä¸€ç§:
docker compose up -d temporal     # Docker æ–¹å¼ (UI: http://localhost:8080)
# æˆ–
temporal server start-dev         # æœ¬åœ° dev æ–¹å¼ (UI: http://localhost:8233)

# 2. åç«¯ (FastAPI + Temporal Worker)
cd backend && make dev

# 3. å‰ç«¯ (Next.js)
cd frontend && npm run dev
```

> **æ³¨æ„**: `make dev`ï¼ˆæ ¹ç›®å½•ï¼‰å·²åŒ…å«æœ¬åœ° Temporal dev serverï¼Œä¸è¦åŒæ—¶è¿è¡Œ Docker Temporalï¼Œå¦åˆ™ä¼šç«¯å£å†²çªã€‚

éªŒè¯æœåŠ¡æ­£å¸¸:
```bash
curl http://localhost:8000/docs        # FastAPI Swagger UI
curl http://localhost:3000/batch-bugs  # å‰ç«¯é¡µé¢
```

---

## Step 1: æ‰“å¼€é¡µé¢ â€” é…ç½® Tab

æµè§ˆå™¨æ‰“å¼€ `http://localhost:3000/batch-bugs`

**ä½ ä¼šçœ‹åˆ°:**
- ä¸‰ä¸ª Tab: **é…ç½®** (é»˜è®¤æ¿€æ´»)ã€**æ‰§è¡Œ** (Job æäº¤å‰ç¦ç”¨) å’Œ **åº¦é‡** (BarChart3 å›¾æ ‡, æ˜¾ç¤ºå…¨å±€/å• Job ä¿®å¤ç»Ÿè®¡)
- å·¦ä¾§: é…ç½®è¡¨å• (Jira URL è¾“å…¥ã€å‚æ•°é€‰æ‹©)
- å³ä¾§: å†å²ä»»åŠ¡åˆ—è¡¨

**é¡µé¢å¸ƒå±€:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¡µé¢æ ‡é¢˜    [Workspace é€‰æ‹©å™¨ â–¾]                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [é…ç½®]  [æ‰§è¡Œ(ç¦ç”¨)]  [åº¦é‡]                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å·¦ä¾§: é…ç½®è¡¨å•          â”‚  å³ä¾§: å†å²ä»»åŠ¡          â”‚
â”‚                          â”‚                          â”‚
â”‚  1. Jira Bug é“¾æ¥è¾“å…¥    â”‚  âœ“ job_abc123  2min ago  â”‚
â”‚  2. é…ç½®é€‰é¡¹             â”‚  âœ— job_def456  1hr ago   â”‚
â”‚  3. ç›®æ ‡ä»£ç åº“è·¯å¾„       â”‚  ...                     â”‚
â”‚                          â”‚                          â”‚
â”‚  [é¢„è§ˆ]  [å¼€å§‹ä¿®å¤]      â”‚  [åˆ·æ–°]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> æ³¨: Workspace é€‰æ‹©å™¨åœ¨é¡µé¢æ ‡é¢˜åŒè¡Œçš„ header åŒºåŸŸï¼Œä¸åœ¨é…ç½®è¡¨å•å†…ã€‚
> æ—  Workspace æ—¶å·¦ä¾§ä¼šæ˜¾ç¤º DirectoryPicker é€‰æ‹©ä»£ç ç›®å½•ã€‚

---

## Step 2: é€‰æ‹© Workspace

**æ“ä½œ:**
1. é¡µé¢é¡¶éƒ¨æœ‰ Workspace æ ‡ç­¾ç»„
2. ç‚¹å‡» `+` åˆ›å»ºæ–° Workspace:
   - è¾“å…¥åç§° (å¦‚ "MyProject")
   - é€‰æ‹©ä»£ç ä»“åº“è·¯å¾„ (Claude CLI çš„å·¥ä½œç›®å½•)
   - ä¿å­˜ â†’ è‡ªåŠ¨é€‰ä¸­
3. æˆ–ç‚¹å‡»å·²æœ‰ Workspace åˆ‡æ¢

**ä¸ºä»€ä¹ˆéœ€è¦ Workspace:**
- Workspace ç»‘å®šä¸€ä¸ªä»£ç ä»“åº“è·¯å¾„, Claude CLI ä¼šåœ¨è¯¥ç›®å½•ä¸‹æ‰§è¡Œä¿®å¤
- å¯ä»¥ä¿å­˜é»˜è®¤é…ç½® (éªŒè¯çº§åˆ«ã€å¤±è´¥ç­–ç•¥ç­‰)
- æ¯ä¸ª Workspace çš„ä»»åŠ¡å†å²ç‹¬ç«‹ç®¡ç†

> å¦‚æœè·³è¿‡ Workspace, éœ€è¦æ‰‹åŠ¨è¾“å…¥ç›®æ ‡ä»£ç åº“è·¯å¾„

---

## Step 3: è¾“å…¥ Jira Bug é“¾æ¥

**ä¸¤ç§è¾“å…¥æ–¹å¼:**

### æ–¹å¼ A: URL æ¨¡å¼ (æ¨è)

1. ç‚¹å‡» **URL æ¨¡å¼** Tab
2. æ¯è¡Œç²˜è´´ä¸€ä¸ª Bug URL:
```
https://jira.example.com/browse/BUG-1234
https://jira.example.com/browse/BUG-1235
https://jira.example.com/browse/BUG-1236
```
3. ä¸‹æ–¹æ˜¾ç¤ºè®¡æ•°: "å·²è¾“å…¥ 3 ä¸ªé“¾æ¥"

### æ–¹å¼ B: JQL æŸ¥è¯¢

1. ç‚¹å‡» **JQL æŸ¥è¯¢** Tab
2. è¾“å…¥ JQL:
```
project = BUG AND type = Bug AND status = "To Do"
```
3. ç‚¹å‡»æŸ¥è¯¢ â†’ ç»“æœåˆ—è¡¨æ˜¾ç¤º (Bug Keyã€çŠ¶æ€ã€ä¼˜å…ˆçº§ã€æ‘˜è¦)
4. ç”¨å¤é€‰æ¡†é€‰æ‹©è¦ä¿®å¤çš„ Bug
5. ç‚¹å‡» "å¯¼å…¥é€‰ä¸­ (N)" â†’ URL è‡ªåŠ¨å¡«å…¥

**åç«¯ API:**
```
POST /api/v2/jira/query
{ "jql": "project = BUG AND type = Bug AND status = \"To Do\"" }
```

---

## Step 4: é…ç½®æ‰§è¡Œå‚æ•°

### éªŒè¯çº§åˆ« (Validation Level)

| é€‰é¡¹ | å«ä¹‰ | è€—æ—¶ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| å¿«é€ŸéªŒè¯ (minimal) | ä»… lint | ~30-60s/bug | å¿«é€ŸåŸå‹ |
| æ ‡å‡†éªŒè¯ (standard) | lint + å•å…ƒæµ‹è¯• | ~2-5min/bug | **æ¨èæ—¥å¸¸ä½¿ç”¨** |
| å®Œæ•´éªŒè¯ (thorough) | lint + å•å…ƒ + E2E | ~10-20min/bug | å…³é”®ä¿®å¤ |

### å¤±è´¥ç­–ç•¥ (Failure Policy)

| é€‰é¡¹ | è¡Œä¸º | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| è·³è¿‡ç»§ç»­ (skip) | å¤±è´¥åç»§ç»­ä¸‹ä¸€ä¸ª | **æ¨èæ‰¹é‡å¤„ç†** |
| åœæ­¢ç­‰å¾… (stop) | é¦–ä¸ªå¤±è´¥å³åœæ­¢ | å…³é”®ä¿®å¤ |
| è‡ªåŠ¨é‡è¯• (retry) | å¤±è´¥åè‡ªåŠ¨é‡è¯• N æ¬¡ | ç¯å¢ƒä¸ç¨³å®šæ—¶ |

---

## Step 5: é¢„è§ˆæˆ–ç›´æ¥æ‰§è¡Œ

### é¢„è§ˆ (Dry Run)

1. ç‚¹å‡» **"é¢„è§ˆ"** (çœ¼ç›å›¾æ ‡)
2. å¼¹å‡º Dry Run é¢„è§ˆé¢æ¿:
   - Bug æ€»æ•°
   - å·¥ä½œç›®å½•
   - é…ç½®å‚æ•°æ±‡æ€»
   - æ¯ä¸ª Bug çš„é¢„æœŸæ‰§è¡Œæ­¥éª¤
3. ç¡®è®¤æ— è¯¯ â†’ ç‚¹å‡» **"ç¡®è®¤æ‰§è¡Œ"**
4. æˆ–ç‚¹å‡» "å–æ¶ˆ" è¿”å›ä¿®æ”¹

**åç«¯ API (dry run):**
```
POST /api/v2/batch/bug-fix
{
  "jira_urls": ["https://jira.example.com/browse/BUG-1234"],
  "cwd": "/path/to/repo",
  "dry_run": true,
  "config": { "validation_level": "standard", "failure_policy": "skip", "max_retries": 2 }
}
```

### ç›´æ¥æ‰§è¡Œ

ç‚¹å‡» **"å¼€å§‹ä¿®å¤"** (primary é’è‰²æŒ‰é’®) â†’ è·³è¿‡é¢„è§ˆç›´æ¥æäº¤

**åç«¯ API (å®é™…æ‰§è¡Œ):**
```
POST /api/v2/batch/bug-fix
{
  "jira_urls": [
    "https://jira.example.com/browse/BUG-1234",
    "https://jira.example.com/browse/BUG-1235"
  ],
  "cwd": "/Users/you/projects/myapp",
  "config": {
    "validation_level": "standard",
    "failure_policy": "skip",
    "max_retries": 2
  }
}

Response:
{ "job_id": "job_a1b2c3d4e5f6", "status": "started" }
```

---

## Step 6: å®æ—¶æ‰§è¡Œç›‘æ§ â€” æ‰§è¡Œ Tab

æäº¤å UI è‡ªåŠ¨åˆ‡æ¢åˆ° **æ‰§è¡Œ Tab**ã€‚

**å¸ƒå±€:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ‰§è¡Œè¿›åº¦  3/5 å®Œæˆ                                  â”‚
â”‚  [BUG-1 âœ…]â†’[BUG-2 âœ…]â†’[BUG-3 ğŸ”§]â†’[BUG-4 â³]â†’[BUG-5 â³] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ‰§è¡Œæ—¥å¿— [LIVE ğŸ”´]      â”‚  ä»»åŠ¡æ€»è§ˆ               â”‚
â”‚                          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  BUG-1 âœ… å®Œæˆ Â· 3m20s  â”‚  â”‚ çŠ¶æ€: ä¿®å¤ä¸­       â”‚  â”‚
â”‚  â”” ğŸ’­ åˆ†æé—®é¢˜...       â”‚  â”‚ è¿›åº¦: â–ˆâ–ˆâ–ˆâ–‘â–‘ 60%    â”‚  â”‚
â”‚  â”” âœï¸ ä¿®æ”¹ login.py    â”‚  â”‚ å®Œæˆ: 3 è¿›è¡Œ: 1    â”‚  â”‚
â”‚  â”” âš™ï¸ pytest â†’ passed  â”‚  â”‚ ç­‰å¾…: 1 å¤±è´¥: 0    â”‚  â”‚
â”‚  â”” ğŸ“„ ä¿®å¤å®Œæˆ         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                          â”‚
â”‚  BUG-2 âœ… å®Œæˆ Â· 2m15s  â”‚  [å–æ¶ˆä»»åŠ¡] [æ–°å»ºä»»åŠ¡]  â”‚
â”‚  â”” ...                  â”‚                          â”‚
â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  BUG-3 ğŸ”§ ä¿®å¤ä¸­ Â· 1m   â”‚  å†å²ä»»åŠ¡               â”‚
â”‚  â”” ğŸ’­ æ­£åœ¨åˆ†æ...       â”‚  ...                     â”‚
â”‚                          â”‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.1 Pipeline Bar (é¡¶éƒ¨è¿›åº¦æ¡)

- æ¯ä¸ª Bug ä¸€ä¸ª Badge, æ˜¾ç¤ºçŠ¶æ€å›¾æ ‡ + Bug ID + è€—æ—¶
- é¢œè‰²ç¼–ç : ç»¿è‰²=å®Œæˆ, è“è‰²=è¿›è¡Œä¸­(å‘å…‰), ç°è‰²=ç­‰å¾…, çº¢è‰²=å¤±è´¥
- ç‚¹å‡» Badge å¯è·³è½¬åˆ°å¯¹åº” Bug çš„æ—¥å¿—åŒºåŸŸ

### 6.2 Activity Feed (å·¦ä¾§æ‰§è¡Œæ—¥å¿—)

å®æ—¶æ˜¾ç¤º AI çš„æ€è€ƒå’Œæ“ä½œè¿‡ç¨‹:

| å›¾æ ‡ | äº‹ä»¶ç±»å‹ | å«ä¹‰ |
|------|----------|------|
| ğŸ’­ | Thinking | Claude çš„æ¨ç†è¿‡ç¨‹ |
| ğŸ“– | Read | æ­£åœ¨è¯»å–æ–‡ä»¶ |
| âœï¸ | Edit | ä¿®æ”¹ä»£ç  (æ˜¾ç¤º diff) |
| âš™ï¸ | Bash | æ‰§è¡Œå‘½ä»¤ (æ˜¾ç¤ºè¾“å‡º) |
| ğŸ“„ | Result | æœ€ç»ˆç»“æœæˆ–é”™è¯¯ |

**ç‰¹æ®ŠåŠŸèƒ½:**
- **LIVE çº¢ç‚¹**: AI æ­£åœ¨æ‰§è¡Œæ—¶è„‰å†²é—ªçƒ
- **å½“å‰ Bug æ ‡ç­¾**: "å½“å‰: BUG-3 (3/5)"
- **Token ç»Ÿè®¡**: åº•éƒ¨æ˜¾ç¤º "1,234 / 5,678 tokens Â· $0.45"
- **SSE æ–­è¿æç¤º**: çº¢è‰²æ¨ªå¹… "è¿æ¥å·²æ–­å¼€ï¼Œæ­£åœ¨é‡è¿..."
- **é‡è¯•æŒ‰é’®**: Bug å¤±è´¥åæ˜¾ç¤ºæ©™è‰² "é‡è¯•" æŒ‰é’®

### 6.3 Overview (å³ä¾§æ€»è§ˆé¢æ¿)

- çŠ¶æ€æŒ‡ç¤ºå™¨ (é¢œè‰²ç¼–ç )
- è¿›åº¦æ¡ (ç™¾åˆ†æ¯”)
- ç»Ÿè®¡ç½‘æ ¼: å®Œæˆ/è¿›è¡Œ/ç­‰å¾…/è·³è¿‡/å¤±è´¥
- Bug åˆ—è¡¨ (ç®€çº¦ç‰ˆ)
- **å–æ¶ˆä»»åŠ¡** æŒ‰é’® (çº¢è‰², éœ€ç¡®è®¤)
- **æ–°å»ºä»»åŠ¡** æŒ‰é’®

---

## Step 7: å¤„ç†å¤±è´¥çš„ Bug

### è‡ªåŠ¨å¤„ç† (æŒ‰å¤±è´¥ç­–ç•¥)

- **skip**: è‡ªåŠ¨è·³è¿‡, ç»§ç»­ä¸‹ä¸€ä¸ª
- **retry**: è‡ªåŠ¨é‡è¯•æœ€å¤š N æ¬¡
- **stop**: æ•´ä¸ª Job æš‚åœ

### æ‰‹åŠ¨é‡è¯•å•ä¸ª Bug

1. åœ¨ Activity Feed ä¸­æ‰¾åˆ°å¤±è´¥çš„ Bug
2. å±•å¼€æŸ¥çœ‹é”™è¯¯è¯¦æƒ…
3. ç‚¹å‡»æ©™è‰² **"é‡è¯•"** æŒ‰é’®
4. Bug çŠ¶æ€é‡ç½®ä¸º pending, é‡æ–°å¼€å§‹ä¿®å¤

**åç«¯ API:**
```
POST /api/v2/batch/bug-fix/{job_id}/retry/{bug_index}
```

### å–æ¶ˆæ•´ä¸ª Job

1. ç‚¹å‡»å³ä¾§ **"å–æ¶ˆä»»åŠ¡"** æŒ‰é’®
2. ç¡®è®¤å¯¹è¯æ¡† â†’ ç¡®è®¤
3. å·²å®Œæˆçš„ Bug ä¸å—å½±å“, è¿›è¡Œä¸­çš„ Bug è¢«æ ‡è®°ä¸ºå¤±è´¥

**åç«¯ API:**
```
POST /api/v2/batch/bug-fix/{job_id}/cancel
```

---

## Step 8: æŸ¥çœ‹ç»“æœ

Job å®Œæˆå:

1. Pipeline Bar æ‰€æœ‰ Badge æ˜¾ç¤ºæœ€ç»ˆçŠ¶æ€
2. Activity Feed å®Œæ•´ä¿ç•™æ‰€æœ‰äº‹ä»¶
3. Overview æ˜¾ç¤ºæœ€ç»ˆç»Ÿè®¡: "4 å®Œæˆ âœ…, 1 å¤±è´¥ âŒ"
4. å¯åˆ‡æ¢åˆ° **åº¦é‡ Tab** æŸ¥çœ‹æ€§èƒ½æŒ‡æ ‡

### åº¦é‡ Tab

- æ€» Job æ•°ã€æ€» Bug æ•°ã€æ•´ä½“æˆåŠŸç‡
- æ¯æ­¥å¹³å‡è€—æ—¶
- æœ€è¿‘ Job åˆ—è¡¨ (æˆåŠŸç‡ã€è€—æ—¶å¯¹æ¯”)

---

## SSE äº‹ä»¶æµå‚è€ƒ

å‰ç«¯é€šè¿‡ SSE è®¢é˜…å®æ—¶äº‹ä»¶:
```
GET /api/v2/batch/bug-fix/{job_id}/stream
```

| äº‹ä»¶ç±»å‹ | è§¦å‘æ—¶æœº | å…³é”®æ•°æ® |
|----------|----------|----------|
| `job_state` | è¿æ¥å»ºç«‹æ—¶ | å®Œæ•´ Job çŠ¶æ€ |
| `bug_started` | Bug å¼€å§‹å¤„ç† | bug_index, url |
| `bug_step_started` | æ­¥éª¤å¼€å§‹ | step, label, attempt |
| `bug_step_completed` | æ­¥éª¤å®Œæˆ | duration_ms, output_preview |
| `bug_step_failed` | æ­¥éª¤å¤±è´¥ | error |
| `bug_completed` | Bug ä¿®å¤æˆåŠŸ | retry_count |
| `bug_failed` | Bug ä¿®å¤å¤±è´¥ | error |
| `bug_skipped` | Bug è¢«è·³è¿‡ | reason |
| `ai_thinking` | AI æ€è€ƒ/æ“ä½œ | type, content, bug_index |
| `db_sync_warning` | DB åŒæ­¥å¤±è´¥ | message |
| `job_done` | Job ç»“æŸ | status, completed, failed |

---

# ç¬¬äºŒéƒ¨åˆ†: Design-to-Spec ç®¡çº¿

## å‰ç½®æ¡ä»¶

é™¤äº†åç«¯å’Œå‰ç«¯æœåŠ¡å¤–, è¿˜éœ€è¦:

```bash
# è®¾ç½® Figma Token (å¿…é¡»)
export FIGMA_TOKEN="figd_your_personal_access_token_here"

# ç¡®ä¿åç«¯åŠ è½½äº†è¯¥ç¯å¢ƒå˜é‡
source .env && make dev
```

è·å– Figma Token: https://www.figma.com/developers/api#access-tokens

---

## Step 1: æ‰“å¼€é¡µé¢ â€” é…ç½® Tab

æµè§ˆå™¨æ‰“å¼€ `http://localhost:3000/design-to-code`

**ä½ ä¼šçœ‹åˆ°:**
- ä¸¤ä¸ª Tab: **é…ç½®** (é»˜è®¤) å’Œ **æ‰§è¡Œ** (ç¦ç”¨)
- é…ç½®è¡¨å•: Figma URL + è¾“å‡ºç›®å½•
- å³ä¾§: å†å²ä»»åŠ¡ (DesignHistoryCard)

**å¸ƒå±€:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è®¾è®¡è½¬è§„æ ¼                                          â”‚
â”‚  [é…ç½®]  [æ‰§è¡Œ(ç¦ç”¨)]                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é…ç½®è¡¨å•                â”‚  å†å²ä»»åŠ¡                 â”‚
â”‚                          â”‚                          â”‚
â”‚  Figma è®¾è®¡ç¨¿ URL:       â”‚  âœ“ #13eb6f76 1min ago   â”‚
â”‚  [_________________________] â”‚    12 ç»„ä»¶              â”‚
â”‚                          â”‚                          â”‚
â”‚  è¾“å‡ºç›®å½•:               â”‚  âœ— #a1b2c3d4 3hr ago    â”‚
â”‚  [_________________________] â”‚    8 ç»„ä»¶ (1 å¤±è´¥)      â”‚
â”‚                          â”‚                          â”‚
â”‚  [æ‰«æ]  [ç”Ÿæˆè®¾è®¡è§„æ ¼]  â”‚  [ğŸ”„ åˆ·æ–°]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Step 2: è¾“å…¥ Figma URL

**æ“ä½œ:**
1. åœ¨ Figma ä¸­æ‰“å¼€ç›®æ ‡è®¾è®¡ç¨¿
2. é€‰ä¸­è¦åˆ†æçš„ Frame/Page
3. å¤åˆ¶æµè§ˆå™¨åœ°å€æ çš„ URL
4. ç²˜è´´åˆ° "Figma è®¾è®¡ç¨¿ URL" è¾“å…¥æ¡†

**URL æ ¼å¼è¦æ±‚:**
```
âœ“ https://www.figma.com/design/6kGd851.../PixelCheese?node-id=2172-2255
âœ“ https://www.figma.com/file/6kGd851.../PixelCheese?node-id=2172-2255
âœ— https://www.figma.com/design/6kGd851.../PixelCheese  (ç¼ºå°‘ node-id)
```

> URL ä¸­çš„ `node-id` å‚æ•°å†³å®šäº†åˆ†æå“ªä¸ª Frame

---

## Step 3: è®¾ç½®è¾“å‡ºç›®å½•

è¾“å…¥ç”Ÿæˆç»“æœçš„å­˜å‚¨è·¯å¾„, ä¾‹å¦‚:
```
output/spec
```

å®é™…è¾“å‡ºç›®å½•ä¼šæŒ‰ Job ID éš”ç¦»: `output/spec/spec_13eb6f76c482/`

> ä¸¤ä¸ªè¾“å…¥æ¡†çš„å€¼ä¼šè‡ªåŠ¨ä¿å­˜åˆ° localStorage, ä¸‹æ¬¡æ‰“å¼€é¡µé¢è‡ªåŠ¨å¡«å……

---

## Step 4: (å¯é€‰) æ‰«æ Figma é¢„è§ˆ

> **æ³¨**: æ‰«æåŠŸèƒ½ä»£ç å·²å°±ç»ªï¼ˆ`handleScan` å‡½æ•°å’Œ `ScanResults` ç»„ä»¶ï¼‰ï¼Œä½†å½“å‰ UI ç‰ˆæœ¬ä¸­æ‰«ææŒ‰é’®æš‚æœªæš´éœ²ã€‚å¯ç›´æ¥è·³åˆ° Step 5 ä½¿ç”¨"ç”Ÿæˆè®¾è®¡è§„æ ¼"æŒ‰é’®ã€‚ä»¥ä¸‹æè¿°ä¿ç•™ç”¨äºç†è§£æ‰«ææµç¨‹çš„ API å±‚è®¾è®¡ã€‚

æ‰«ææŒ‰é’®ï¼ˆå¦‚åç»­æ¢å¤ï¼‰â†’ åç«¯åˆ†æ Figma æ–‡ä»¶ç»“æ„:

```
POST /api/v2/design/scan-figma
{ "figma_url": "https://..." }
```

**æ‰«æç»“æœæ˜¾ç¤º:**
- ğŸ“± **UI å±å¹•**: è¯†åˆ«å‡ºçš„ç•Œé¢å¸§ (å¸¦ç¼©ç•¥å›¾ã€è®¾å¤‡ç±»å‹)
- ğŸ“ **äº¤äº’è§„æ ¼**: å…³è”çš„äº¤äº’è¯´æ˜
- ğŸ¨ **è®¾è®¡ç³»ç»Ÿ**: Design Token ç»„ä»¶
- âš ï¸ **è­¦å‘Š**: å¦‚èŠ‚ç‚¹å¤ªå°ç­‰é—®é¢˜

**æ“ä½œ:**
- ç”¨å¤é€‰æ¡†é€‰æ‹©/å–æ¶ˆé€‰æ‹© Frame
- ç‚¹å‡» **"ç¡®è®¤å¼€å§‹ (N)"** æäº¤é€‰ä¸­çš„ Frame

---

## Step 5: æäº¤ Spec ç”Ÿæˆ

ç‚¹å‡» **"ç”Ÿæˆè®¾è®¡è§„æ ¼"** æˆ–æ‰«æå **"ç¡®è®¤å¼€å§‹"**:

```
POST /api/v2/design/run-spec
{
  "figma_url": "https://...",
  "output_dir": "output/spec"
}

Response:
{
  "job_id": "spec_13eb6f76c482",
  "status": "started",
  "design_file": ".../spec_13eb6f76c482/design_spec.json"
}
```

UI è‡ªåŠ¨åˆ‡æ¢åˆ° **æ‰§è¡Œ Tab**ã€‚

---

## Step 6: å®æ—¶ç›‘æ§æ‰§è¡Œ

**è¿è¡Œä¸­å¸ƒå±€:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ‰§è¡Œ (4/12 ç”Ÿæˆä¸­...)  [spec_13eb...] [çŠ¶æ€: ç”Ÿæˆä¸­]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  DesignEventFeed         â”‚  DesignOverview          â”‚
â”‚  (ç®¡çº¿æ—¥å¿—)              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                          â”‚  â”‚ çŠ¶æ€: ç”Ÿæˆä¸­ ğŸŸ£    â”‚  â”‚
â”‚  ç­›é€‰: [å…¨éƒ¨][èŠ‚ç‚¹]      â”‚  â”‚ è¿›åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–‘ 33%   â”‚  â”‚
â”‚        [åˆ†æ][å¾ªç¯][é”™è¯¯] â”‚  â”‚ å®Œæˆ: 4  ç­‰å¾…: 7  â”‚  â”‚
â”‚                          â”‚  â”‚ å¤±è´¥: 1            â”‚  â”‚
â”‚  ğŸš€ Pipeline å¯åŠ¨        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  ğŸ”— Figma è·å–ä¸­...      â”‚                          â”‚
â”‚  ğŸ“Š ç»“æ„åˆ†è§£å®Œæˆ (12)    â”‚  SpecTree (å®æ—¶)         â”‚
â”‚  ğŸ§  LoginButton åˆ†æä¸­   â”‚  â”œ ğŸ“± LoginScreen       â”‚
â”‚  ğŸ§  HeaderBar åˆ†æå®Œæˆ   â”‚  â”‚  â”œ ğŸ”µ HeaderBar âœ“    â”‚
â”‚  ğŸ§  LoginForm åˆ†æä¸­     â”‚  â”‚  â”œ ğŸŸ¡ LoginForm â³   â”‚
â”‚                          â”‚  â”‚  â”œ âšª Footer Â·        â”‚
â”‚                          â”‚  â”‚  â”” ...               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.1 DesignEventFeed (å·¦ä¾§)

å®æ—¶æ˜¾ç¤ºç®¡çº¿æ¯ä¸ªé˜¶æ®µçš„äº‹ä»¶:

| å›¾æ ‡ | äº‹ä»¶ | å«ä¹‰ |
|------|------|------|
| ğŸš€ | workflow_start | ç®¡çº¿å¯åŠ¨ |
| ğŸ”— | figma_fetch_start | æ­£åœ¨è·å– Figma æ•°æ® |
| ğŸ“Š | frame_decomposed | ç»“æ„åˆ†è§£å®Œæˆ (ç»„ä»¶åˆ—è¡¨ç¡®å®š) |
| ğŸ§  | spec_analyzed | å•ä¸ªç»„ä»¶ AI åˆ†æå®Œæˆ |
| ğŸ’­ | ai_thinking | AI æ¨ç†è¿‡ç¨‹ |
| ğŸ”„ | loop_iteration | ç»„ä»¶è¿­ä»£å¤„ç† |
| âœ… | spec_complete | æ‰€æœ‰ç»„ä»¶åˆ†æå®Œæˆ |
| âŒ | workflow_error | é”™è¯¯ |

**ç­›é€‰å™¨**: å¯æŒ‰ç±»å‹è¿‡æ»¤äº‹ä»¶ (å…¨éƒ¨/èŠ‚ç‚¹/åˆ†æ/å¾ªç¯/é”™è¯¯)

### 6.2 DesignOverview (å³ä¸Š)

- çŠ¶æ€ Badge: å¯åŠ¨ä¸­/ç”Ÿæˆä¸­/å·²å®Œæˆ/å¤±è´¥/å·²å–æ¶ˆ
- è¿›åº¦æ¡ (ç»„ä»¶å®Œæˆç™¾åˆ†æ¯”)
- ç»Ÿè®¡: å®Œæˆ/ç­‰å¾…/å¤±è´¥
- ç»„ä»¶è¿›åº¦åˆ—è¡¨ (å‰ 10 ä¸ª, å®æ—¶æ›´æ–°çŠ¶æ€)
- Token ç”¨é‡ (è¾“å…¥/è¾“å‡º, å¯å±•å¼€çœ‹æ¯ä¸ªç»„ä»¶)
- å–æ¶ˆ/æ–°å»ºæŒ‰é’®

### 6.3 SpecTree (å³ä¸‹, å®æ—¶)

- éšç€ `frame_decomposed` äº‹ä»¶åˆ°è¾¾, ç»„ä»¶é€ä¸ªå‡ºç°
- æ¯ä¸ªç»„ä»¶æ˜¾ç¤º: çŠ¶æ€ç‚¹ + åç§° + è§’è‰² Badge + å°ºå¯¸
- æœç´¢æ¡†: æŒ‰åç§°è¿‡æ»¤
- è§’è‰²ç­›é€‰: åªçœ‹ç‰¹å®šç±»å‹çš„ç»„ä»¶

---

## Step 7: æŸ¥çœ‹å®Œæˆç»“æœ â€” SpecBrowser

Job å®Œæˆå, æ‰§è¡Œ Tab åˆ‡æ¢ä¸ºå…¨å®½ **SpecBrowser** ä¸‰é¢æ¿å¸ƒå±€:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [âœ“ å·²å®Œæˆ] 12/12 ç»„ä»¶ | PixelCheese | [æ–°å»º] [æ—¥å¿—]â”‚
â”‚  Token ç”¨é‡: è¾“å…¥ 8450  è¾“å‡º 5280  åˆè®¡ 13730       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚SpecTreeâ”‚      SpecCard             â”‚  SpecPreview   â”‚
â”‚ (240px)â”‚      (flex)               â”‚  (280px)       â”‚
â”‚        â”‚                           â”‚                â”‚
â”‚ ğŸ”æœç´¢ â”‚  LoginButton              â”‚  [æˆªå›¾é¢„è§ˆ]    â”‚
â”‚ [è§’è‰²] â”‚  role: button             â”‚                â”‚
â”‚ [åˆ†ç»„] â”‚  "ä¸»è¦ç™»å½•æŒ‰é’®"           â”‚                â”‚
â”‚        â”‚  120Ã—48 | id:comp-1001    â”‚                â”‚
â”‚ HeaderBarâ”‚                          â”‚                â”‚
â”‚ LoginFormâ”‚ â–¸ è®¾è®¡è§£è¯»              â”‚                â”‚
â”‚ Footer â”‚   AI ç”Ÿæˆçš„è¯¦ç»†åˆ†ææ–‡æœ¬   â”‚                â”‚
â”‚ ...    â”‚ â–¸ å¸ƒå±€: flex row gap:8    â”‚                â”‚
â”‚        â”‚ â–¸ æ ·å¼: bg:#007AFF r:8   â”‚                â”‚
â”‚        â”‚ â–¸ æ–‡å­—: Inter 14 600     â”‚                â”‚
â”‚        â”‚ â–¸ äº¤äº’: click â†’ submit   â”‚                â”‚
â”‚        â”‚ â–¸ å­èŠ‚ç‚¹: 2 ä¸ª           â”‚                â”‚
â”‚        â”‚                           â”‚                â”‚
â”‚        â”‚ [å¤åˆ¶ä¸ºæç¤ºè¯] [JSON]     â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SpecTree (å·¦é¢æ¿)

- ç»„ä»¶å±‚çº§æ ‘
- **æœç´¢**: æŒ‰åç§°/æè¿°è¿‡æ»¤
- **è§’è‰²ç­›é€‰**: åªçœ‹ button/card/list ç­‰ç‰¹å®šç±»å‹
- **åˆ†ç»„**: æŒ‰è§’è‰²åˆ†ç±» (Structure/Navigation/Interactive/Content/Utility)
- ç‚¹å‡»ç»„ä»¶ â†’ å³ä¾§ SpecCard åŠ è½½è¯¦æƒ…

### SpecCard (ä¸­é—´é¢æ¿)

- **å¤´éƒ¨**: ç»„ä»¶å + è§’è‰² Badge + æè¿° + åæ ‡/å°ºå¯¸/ID
- **å¯æŠ˜å åŒºåŸŸ**:
  - è®¾è®¡è§£è¯»: AI ç”Ÿæˆçš„è‡ªç„¶è¯­è¨€æè¿° (**æ ¸å¿ƒä»·å€¼**)
  - å¸ƒå±€: flex æ–¹å‘ã€gapã€paddingã€å¯¹é½
  - å°ºå¯¸: å®½é«˜çº¦æŸ
  - æ ·å¼: èƒŒæ™¯è‰²ã€åœ†è§’ã€é˜´å½±ã€é€æ˜åº¦
  - æ–‡å­—: å­—ä½“ã€å¤§å°ã€ç²—ç»†ã€é¢œè‰²
  - äº¤äº’: ç‚¹å‡»/æ‚¬åœè¡Œä¸º
  - å­èŠ‚ç‚¹: å­ç»„ä»¶åˆ—è¡¨ (å¯ç‚¹å‡»å¯¼èˆª)

### SpecPreview (å³é¢æ¿)

- Figma æˆªå›¾ (ä» `/api/v2/design/{job_id}/screenshots/{node_id}.png` åŠ è½½)
- è®¾å¤‡ç±»å‹æŒ‡ç¤º

### å¯¼å‡ºæ“ä½œ

| æŒ‰é’® | åŠŸèƒ½ |
|------|------|
| å¤åˆ¶ä¸ºæç¤ºè¯ | æ ¼å¼åŒ–ä¸º Markdown, é€‚åˆç²˜è´´ç»™ LLM |
| JSON | å¤åˆ¶ç»„ä»¶çš„ JSON ç»“æ„ |
| ä¸‹è½½ | ä¸‹è½½å®Œæ•´ `design_spec.json` æ–‡ä»¶ |

---

## Step 8: å†å²è®°å½•ä¸æ¢å¤

### DesignHistoryCard

é…ç½® Tab å³ä¾§æ˜¾ç¤ºå†å² Job:
- çŠ¶æ€å›¾æ ‡ + Job ID (çŸ­) + ç›¸å¯¹æ—¶é—´ + ç»„ä»¶æ•°
- æˆåŠŸ/å¤±è´¥è®¡æ•° Badge
- å±•å¼€æŸ¥çœ‹è¯¦æƒ… (è¾“å‡ºç›®å½•ã€é”™è¯¯ä¿¡æ¯)
- åˆ·æ–°æŒ‰é’®é‡æ–°åŠ è½½

### é¡µé¢æ¢å¤ (Spec Recovery)

åˆ·æ–°é¡µé¢å, å·²å®Œæˆçš„ Job ä¼šè‡ªåŠ¨æ¢å¤:

1. `useDesignJob` hook æ£€æµ‹åˆ° `designSpec === null` ä¸” Job æœ‰ `design_file`
2. è‡ªåŠ¨è°ƒç”¨ `GET /api/v2/design/{job_id}/spec` ä»ç£ç›˜è¯»å–
3. SpecBrowser æ­£å¸¸æ˜¾ç¤º

> è¿™æ˜¯åˆšä¿®å¤çš„ Bug (M30) â€” ä¹‹å‰ designSpec åªé€šè¿‡ SSE äº‹ä»¶å¡«å……, å·²å®Œæˆçš„ Job æ— æ³•æ¢å¤

---

## SSE äº‹ä»¶æµå‚è€ƒ

```
GET /api/v2/design/{job_id}/stream
```

| äº‹ä»¶ | è§¦å‘æ—¶æœº | ç”¨é€” |
|------|----------|------|
| `job_state` | è¿æ¥å»ºç«‹ | åŒæ­¥åˆå§‹çŠ¶æ€ |
| `workflow_start` | ç®¡çº¿å¯åŠ¨ | æ˜¾ç¤ºå¯åŠ¨äº‹ä»¶ |
| `figma_fetch_start` | å¼€å§‹è·å– Figma | è¿›åº¦æç¤º |
| `frame_decomposed` | ç»“æ„åˆ†è§£å®Œæˆ | SpecTree é¦–æ¬¡æ¸²æŸ“ |
| `spec_analyzed` | å•ç»„ä»¶åˆ†æå®Œæˆ | æ›´æ–° SpecTree çŠ¶æ€ |
| `ai_thinking` | AI æ¨ç†ä¸­ | æ˜¾ç¤ºæ€è€ƒè¿‡ç¨‹ |
| `loop_iteration` | ç»„ä»¶è¿­ä»£ | å¾ªç¯è¿›åº¦ |
| `spec_complete` | å…¨éƒ¨åˆ†æå®Œæˆ | æœ€ç»ˆéªŒè¯ç»“æœ |
| `job_done` | Job ç»“æŸ | åˆ‡æ¢åˆ°å®Œæˆå¸ƒå±€ |
| `workflow_error` | é”™è¯¯ | æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ |

---

# ç¬¬ä¸‰éƒ¨åˆ†: å¸¸è§é—®é¢˜æ’æŸ¥

## 1. SSE è¿æ¥æ–­å¼€ ("è¿æ¥å·²æ–­å¼€ï¼Œæ­£åœ¨é‡è¿...")

**ç°è±¡:** çº¢è‰²æ¨ªå¹…æç¤º, äº‹ä»¶åœæ­¢æ›´æ–°

**æ’æŸ¥:**
1. æ£€æŸ¥åç«¯æ˜¯å¦è¿˜åœ¨è¿è¡Œ: `curl http://localhost:8000/health`
2. æ£€æŸ¥ç½‘ç»œè¿æ¥
3. å‰ç«¯ä¼šæ¯ 5 ç§’è‡ªåŠ¨é‡è¯•

**è§£å†³:**
- ç­‰å¾…è‡ªåŠ¨é‡è¿ (é€šå¸¸ 5-10 ç§’)
- å¦‚æŒç»­æ–­å¼€, åˆ·æ–°é¡µé¢ â†’ è‡ªåŠ¨æ¢å¤ Job çŠ¶æ€

---

## 2. Job å¡åœ¨ "running" çŠ¶æ€ä¸åŠ¨

**ç°è±¡:** è¿›åº¦æ¡åœæ­¢, æ²¡æœ‰æ–°äº‹ä»¶

**æ’æŸ¥:**
1. æ£€æŸ¥ Temporal Worker æ˜¯å¦åœ¨è¿è¡Œ:
   ```bash
   # æ£€æŸ¥ Worker è¿›ç¨‹
   ps aux | grep temporal
   ```
2. æ£€æŸ¥ Temporal UI (Docker: http://localhost:8080, æœ¬åœ° dev: http://localhost:8233) æŸ¥çœ‹ Workflow çŠ¶æ€
3. æŸ¥çœ‹åç«¯æ—¥å¿—: `tail -f backend/logs/api.log` æˆ– `tail -f backend/logs/worker.log`

**è§£å†³:**
- å¦‚æœ Worker å´©æºƒ: é‡å¯ `make dev`
- å¦‚æœ Temporal æ— å“åº”: é‡å¯ Temporal Server
- å–æ¶ˆå¡ä½çš„ Job: ç‚¹å‡» "å–æ¶ˆä»»åŠ¡" æŒ‰é’®

---

## 3. Design-to-Spec å®Œæˆåçœ‹ä¸åˆ° Spec æ•°æ® ("No design spec available.")

**ç°è±¡:** Job çŠ¶æ€æ˜¯ "å·²å®Œæˆ", ä½† SpecBrowser ä¸æ˜¾ç¤ºå†…å®¹

**æ ¹å› :** (å·²ä¿®å¤ M30) ä¹‹å‰ `designSpec` åªé€šè¿‡ SSE äº‹ä»¶å¡«å……, åˆ·æ–°åæ— æ³•æ¢å¤

**æ’æŸ¥:**
1. ç¡®è®¤åç«¯æœ‰ spec æ–‡ä»¶:
   ```bash
   ls -la {output_dir}/{job_id}/design_spec.json   # output_dir ç”±æäº¤æ—¶æŒ‡å®š
   ```
2. ç¡®è®¤ API å¯è¿”å›:
   ```bash
   curl http://localhost:8000/api/v2/design/{job_id}/spec
   ```

**è§£å†³:**
- åˆ·æ–°é¡µé¢ â†’ recovery useEffect è‡ªåŠ¨åŠ è½½
- å¦‚ä»ä¸è¡Œ, æ£€æŸ¥ `design_file` å­—æ®µæ˜¯å¦ä¸ºç©º (ç©º = æ²¡æœ‰æ–‡ä»¶å¯æ¢å¤)

---

## 4. Figma Token é”™è¯¯ ("FIGMA_TOKEN not configured")

**ç°è±¡:** æäº¤ Design-to-Spec ä»»åŠ¡æŠ¥ 400 é”™è¯¯

**æ’æŸ¥:**
```bash
echo $FIGMA_TOKEN  # åº”è¯¥æœ‰å€¼
```

**è§£å†³:**
1. è·å– Token: https://www.figma.com/developers/api#access-tokens
2. è®¾ç½®ç¯å¢ƒå˜é‡:
   ```bash
   export FIGMA_TOKEN="figd_your_token_here"
   ```
3. ç¡®ä¿åç«¯å¯åŠ¨æ—¶åŠ è½½äº†è¯¥å˜é‡:
   ```bash
   source .env && make dev
   ```

---

## 5. Temporal Server æœªå¯åŠ¨ ("æ— æ³•å¯åŠ¨ç®¡çº¿")

**ç°è±¡:** æäº¤ä»»åŠ¡æŠ¥ 503 é”™è¯¯

**æ’æŸ¥:**
```bash
# æ£€æŸ¥ Temporal æ˜¯å¦åœ¨è¿è¡Œ
docker ps | grep temporal
```

**è§£å†³:**
```bash
docker compose up -d temporal
# ç­‰å¾… ~10 ç§’å¯åŠ¨å®Œæˆ
curl http://localhost:7233  # æ£€æŸ¥è¿é€šæ€§
```

---

## 6. Bug ä¿®å¤å¤±è´¥ â€” Claude CLI è¶…æ—¶

**ç°è±¡:** Bug çŠ¶æ€å˜ä¸º "failed", é”™è¯¯ä¿¡æ¯å« "timeout"

**æ’æŸ¥:**
- æŸ¥çœ‹ Activity Feed ä¸­æœ€åçš„ AI æ€è€ƒäº‹ä»¶
- æ£€æŸ¥ç›®æ ‡ä»“åº“å¤§å° (å¤§ä»“åº“ Claude åˆ†ææ›´æ…¢)

**è§£å†³:**
- ä½¿ç”¨ "å¿«é€ŸéªŒè¯" (minimal) å‡å°‘éªŒè¯è€—æ—¶
- ç‚¹å‡» "é‡è¯•" æŒ‰é’®é‡æ–°å°è¯•
- å¦‚æŒç»­è¶…æ—¶, è€ƒè™‘æ‹†åˆ†ä¸ºæ›´å°çš„ä¿®å¤ä»»åŠ¡

---

## 7. JQL æŸ¥è¯¢æ— ç»“æœ

**ç°è±¡:** JQL æŸ¥è¯¢è¿”å›ç©ºåˆ—è¡¨

**æ’æŸ¥:**
1. ç¡®è®¤ Jira å‡­æ®é…ç½®æ­£ç¡® (`.env` ä¸­çš„ `JIRA_URL`, `JIRA_EMAIL`, `JIRA_API_TOKEN`)
2. åœ¨ Jira Web UI ä¸­éªŒè¯åŒä¸€ JQL æ˜¯å¦æœ‰ç»“æœ
3. æ£€æŸ¥åç«¯æ—¥å¿—æ˜¯å¦æœ‰ Jira API é”™è¯¯

**è§£å†³:**
- ä½¿ç”¨ URL æ¨¡å¼æ‰‹åŠ¨ç²˜è´´ Bug é“¾æ¥ (ç»•è¿‡ JQL)
- ä¿®æ­£ JQL è¯­æ³•æˆ– Jira å‡­æ®

---

## API å¿«é€Ÿå‚è€ƒ

### Batch Bug Fix

| æ–¹æ³• | ç«¯ç‚¹ | ç”¨é€” |
|------|------|------|
| POST | `/api/v2/batch/bug-fix` | æäº¤æ‰¹é‡ä¿®å¤ |
| GET | `/api/v2/batch/bug-fix` | åˆ—å‡ºå†å² Job |
| GET | `/api/v2/batch/bug-fix/{job_id}` | æŸ¥çœ‹ Job çŠ¶æ€ |
| GET | `/api/v2/batch/bug-fix/{job_id}/stream` | SSE å®æ—¶äº‹ä»¶ |
| POST | `/api/v2/batch/bug-fix/{job_id}/cancel` | å–æ¶ˆ Job |
| POST | `/api/v2/batch/bug-fix/{job_id}/retry/{bug_index}` | é‡è¯•å•ä¸ª Bug |
| DELETE | `/api/v2/batch/bug-fix/{job_id}` | åˆ é™¤ Job |
| GET | `/api/v2/batch/metrics/global` | å…¨å±€åº¦é‡ |
| GET | `/api/v2/batch/metrics/job/{job_id}` | å• Job åº¦é‡ |
| POST | `/api/v2/batch/bug-fix/batch-delete` | æ‰¹é‡åˆ é™¤ Job |

### Design-to-Spec

| æ–¹æ³• | ç«¯ç‚¹ | ç”¨é€” |
|------|------|------|
| POST | `/api/v2/design/scan-figma` | æ‰«æ Figma ç»“æ„ |
| POST | `/api/v2/design/run-spec` | æäº¤ Spec ç”Ÿæˆ |
| GET | `/api/v2/design` | åˆ—å‡ºå†å² Job |
| GET | `/api/v2/design/{job_id}` | æŸ¥çœ‹ Job çŠ¶æ€ |
| GET | `/api/v2/design/{job_id}/stream` | SSE å®æ—¶äº‹ä»¶ |
| GET | `/api/v2/design/{job_id}/spec` | è·å–ç”Ÿæˆçš„ Spec |
| GET | `/api/v2/design/{job_id}/files` | è·å–è¾“å‡ºæ–‡ä»¶åˆ—è¡¨ |
| POST | `/api/v2/design/{job_id}/cancel` | å–æ¶ˆ Job |
