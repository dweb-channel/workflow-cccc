{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "design-spec-v1",
  "title": "Design Spec Document",
  "description": "Structured design specification for a UI frame, precise enough for an LLM to generate correct code without seeing the original design.",
  "type": "object",
  "required": ["version", "source", "page", "components"],
  "properties": {
    "version": {
      "const": "1.0",
      "description": "Schema version"
    },
    "source": {
      "type": "object",
      "description": "Design file origin",
      "properties": {
        "tool": { "type": "string", "enum": ["figma", "sketch", "xd"] },
        "file_key": { "type": "string" },
        "file_name": { "type": "string" },
        "exported_at": { "type": "string", "format": "date-time" }
      },
      "required": ["tool", "file_key"]
    },
    "page": {
      "type": "object",
      "description": "Page-level context",
      "properties": {
        "name": { "type": "string" },
        "node_id": { "type": "string" },
        "device": {
          "type": "object",
          "properties": {
            "type": { "type": "string", "enum": ["mobile", "tablet", "desktop"] },
            "width": { "type": "number" },
            "height": { "type": "number" }
          }
        },
        "description": {
          "type": "string",
          "description": "Natural language summary of the page's purpose and overall layout"
        },
        "responsive_strategy": {
          "type": "string",
          "enum": ["mobile-first", "desktop-first", "fixed-width"],
          "description": "How this design is intended to scale. mobile-first = designed for phone, scale up. fixed-width = exact px, no scaling."
        },
        "layout": {
          "type": "object",
          "description": "How top-level components are spatially arranged. Use 'stack' when components overlap (e.g. hero image behind nav bar), 'flex' when components flow sequentially.",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["flex", "stack", "absolute"],
              "description": "stack = overlapping layers (use z_index for ordering), flex = sequential flow, absolute = manual positioning"
            },
            "direction": {
              "type": "string",
              "enum": ["row", "column"],
              "description": "Primary axis direction (flex only)"
            }
          }
        }
      }
    },
    "design_tokens": {
      "type": "object",
      "description": "Shared design variables extracted from the file",
      "properties": {
        "colors": {
          "type": "object",
          "additionalProperties": { "type": "string" },
          "description": "Named color tokens, e.g. { \"brand-primary\": \"#FF6B35\" }"
        },
        "typography": {
          "type": "object",
          "properties": {
            "font_family": { "type": "string" },
            "scale": {
              "type": "object",
              "additionalProperties": {
                "type": "object",
                "properties": {
                  "size": { "type": "number" },
                  "weight": { "type": "number" },
                  "line_height": { "type": "number" }
                }
              },
              "description": "Named type scale, e.g. { \"heading-lg\": { \"size\": 24, \"weight\": 600, \"line_height\": 32 } }"
            }
          }
        },
        "spacing": {
          "type": "object",
          "additionalProperties": { "type": "number" },
          "description": "Named spacing tokens in px, e.g. { \"sm\": 4, \"md\": 8, \"lg\": 16 }"
        },
        "radii": {
          "type": "object",
          "additionalProperties": { "type": "number" },
          "description": "Named corner radius tokens, e.g. { \"sm\": 4, \"md\": 8, \"full\": 9999 }"
        }
      }
    },
    "components": {
      "type": "array",
      "description": "Ordered list of component specs in render order (first = bottom layer, last = top layer). When page.layout.type is 'stack', use z_index for explicit layer ordering.",
      "items": { "$ref": "#/$defs/ComponentSpec" }
    }
  },
  "$defs": {
    "ColorValue": {
      "description": "A color value with optional design token reference. When 'token' is present, code should use the token name (e.g. CSS variable) rather than the raw hex value.",
      "oneOf": [
        { "type": "string", "description": "Raw hex color, e.g. '#FF6B35'" },
        {
          "type": "object",
          "properties": {
            "value": { "type": "string", "description": "Resolved hex value" },
            "token": { "type": "string", "description": "Design token name, e.g. 'brand-primary', 'text-secondary'" }
          },
          "required": ["value"]
        }
      ]
    },
    "SpacingValue": {
      "description": "A spacing value with optional token reference.",
      "oneOf": [
        { "type": "number", "description": "Raw px value" },
        {
          "type": "object",
          "properties": {
            "value": { "type": "number", "description": "Resolved px value" },
            "token": { "type": "string", "description": "Spacing token name, e.g. 'sm', 'md', 'lg'" }
          },
          "required": ["value"]
        }
      ]
    },
    "ComponentSpec": {
      "type": "object",
      "required": ["id", "name", "role", "bounds", "layout", "style"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Figma node ID (e.g. '5574:3315')"
        },
        "name": {
          "type": "string",
          "description": "Component name (sanitized for code use)"
        },
        "role": {
          "type": "string",
          "enum": ["page", "section", "container", "card", "list", "list-item", "nav", "header", "footer", "button", "input", "image", "icon", "text", "divider", "badge", "overlay", "decorative", "other"],
          "description": "Semantic role — what this element IS, not what Figma calls it"
        },
        "description": {
          "type": "string",
          "description": "Natural language summary: what this component is, its purpose, and any non-obvious design intent. E.g. 'Top navigation bar with back arrow, centered title, and right-side more icon. Semi-transparent background blurs content beneath.'"
        },
        "z_index": {
          "type": "number",
          "description": "Layer stacking order (0 = bottom-most). Required for stack/absolute layouts where siblings overlap. Derived from Figma children array index."
        },
        "render_hint": {
          "type": "string",
          "enum": ["full", "spacer", "platform"],
          "description": "Rendering strategy hint. 'full' (default) = render all structural/style data. 'spacer' = render as fixed-height empty div (ignore typography/content/interaction). 'platform' = use platform-native component (e.g. iOS StatusBar). Useful for system elements like StatusBar, HomeIndicator, SafeArea."
        },
        "bounds": {
          "type": "object",
          "properties": {
            "x": { "type": "number" },
            "y": { "type": "number" },
            "width": { "type": "number" },
            "height": { "type": "number" }
          },
          "description": "Absolute position and size in px"
        },
        "layout": {
          "type": "object",
          "description": "How this element arranges its children",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["flex", "grid", "absolute", "stack"],
              "description": "flex = auto-layout, absolute = manual positioning, stack = overlapping layers"
            },
            "direction": {
              "type": "string",
              "enum": ["row", "column"],
              "description": "Primary axis direction (flex only)"
            },
            "justify": {
              "type": "string",
              "enum": ["start", "center", "end", "space-between", "space-around"],
              "description": "Main-axis alignment"
            },
            "align": {
              "type": "string",
              "enum": ["start", "center", "end", "stretch", "baseline"],
              "description": "Cross-axis alignment"
            },
            "gap": {
              "$ref": "#/$defs/SpacingValue",
              "description": "Space between children in px, supports token reference"
            },
            "padding": {
              "type": "array",
              "items": { "$ref": "#/$defs/SpacingValue" },
              "minItems": 4,
              "maxItems": 4,
              "description": "[top, right, bottom, left] in px, each value supports token reference"
            },
            "wrap": {
              "type": "boolean",
              "description": "Whether children wrap to next line"
            },
            "overflow": {
              "type": "string",
              "enum": ["visible", "hidden", "scroll"],
              "description": "Content overflow behavior"
            }
          }
        },
        "sizing": {
          "type": "object",
          "description": "How this element sizes itself",
          "properties": {
            "width": {
              "type": "string",
              "description": "Width strategy: exact px value, 'fill' (stretch to parent), 'hug' (fit content), or percentage. E.g. '393px', 'fill', 'hug', '100%'"
            },
            "height": {
              "type": "string",
              "description": "Height strategy, same as width"
            },
            "min_width": { "type": "number" },
            "max_width": { "type": "number" },
            "min_height": { "type": "number" },
            "max_height": { "type": "number" },
            "aspect_ratio": {
              "type": "string",
              "description": "Locked aspect ratio if any, e.g. '16:9', '1:1'"
            }
          }
        },
        "style": {
          "type": "object",
          "description": "Visual appearance",
          "properties": {
            "background": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": ["solid", "gradient-linear", "gradient-radial", "image", "none"]
                },
                "color": {
                  "$ref": "#/$defs/ColorValue",
                  "description": "Background color. Supports raw hex or token reference."
                },
                "gradient": {
                  "type": "object",
                  "properties": {
                    "angle": { "type": "number", "description": "Degrees, 0 = top-to-bottom" },
                    "stops": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "color": { "$ref": "#/$defs/ColorValue" },
                          "position": { "type": "number", "description": "0.0 to 1.0" }
                        }
                      }
                    }
                  }
                },
                "image": {
                  "type": "object",
                  "properties": {
                    "url": { "type": "string" },
                    "fit": { "type": "string", "enum": ["cover", "contain", "fill", "none"] }
                  }
                }
              }
            },
            "border": {
              "type": "object",
              "properties": {
                "width": { "type": "number", "description": "Border width in px (0 = no border)" },
                "color": { "$ref": "#/$defs/ColorValue" },
                "style": { "type": "string", "enum": ["solid", "dashed", "dotted", "none"] },
                "sides": {
                  "type": "string",
                  "enum": ["all", "top", "bottom", "left", "right", "top-bottom", "left-right"],
                  "description": "Which sides have the border"
                }
              }
            },
            "corner_radius": {
              "oneOf": [
                { "type": "number", "description": "Uniform radius in px" },
                {
                  "type": "array",
                  "items": { "type": "number" },
                  "minItems": 4,
                  "maxItems": 4,
                  "description": "[top-left, top-right, bottom-right, bottom-left] in px"
                }
              ]
            },
            "shadow": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "type": { "type": "string", "enum": ["drop", "inner"] },
                  "x": { "type": "number" },
                  "y": { "type": "number" },
                  "blur": { "type": "number" },
                  "spread": { "type": "number" },
                  "color": { "$ref": "#/$defs/ColorValue" }
                }
              },
              "description": "Box shadows, in render order"
            },
            "opacity": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Element opacity (1.0 = fully visible)"
            },
            "blur": {
              "type": "object",
              "properties": {
                "type": { "type": "string", "enum": ["layer", "background"] },
                "radius": { "type": "number" }
              },
              "description": "Blur effect (background blur = backdrop-filter)"
            }
          }
        },
        "typography": {
          "type": "object",
          "description": "Text styling (only for text elements or elements with direct text)",
          "properties": {
            "content": {
              "type": "string",
              "description": "Exact text string as it appears in the design"
            },
            "font_family": { "type": "string" },
            "font_size": { "type": "number", "description": "In px" },
            "font_weight": {
              "type": "number",
              "description": "100-900 numeric weight"
            },
            "line_height": {
              "type": "number",
              "description": "In px (not ratio)"
            },
            "letter_spacing": {
              "type": "number",
              "description": "In px (0 = normal)"
            },
            "color": { "$ref": "#/$defs/ColorValue", "description": "Text color, supports raw hex or token reference" },
            "align": {
              "type": "string",
              "enum": ["left", "center", "right", "justify"]
            },
            "decoration": {
              "type": "string",
              "enum": ["none", "underline", "strikethrough"]
            },
            "transform": {
              "type": "string",
              "enum": ["none", "uppercase", "lowercase", "capitalize"]
            },
            "overflow": {
              "type": "string",
              "enum": ["visible", "ellipsis", "clip"],
              "description": "What happens when text exceeds container"
            },
            "max_lines": {
              "type": "integer",
              "description": "Maximum number of visible lines (null = unlimited)"
            }
          }
        },
        "content": {
          "type": "object",
          "description": "Non-text content",
          "properties": {
            "image": {
              "type": "object",
              "properties": {
                "src": { "type": "string", "description": "Image URL, asset path, or placeholder description" },
                "alt": { "type": "string", "description": "Descriptive alt text for the image content" },
                "fit": { "type": "string", "enum": ["cover", "contain", "fill", "none"], "description": "Object-fit strategy (mapped from Figma scaleMode: FILL→cover, FIT→contain, CROP→cover, TILE→none)" },
                "aspect_ratio": { "type": "string", "description": "Locked aspect ratio, e.g. '16:9', '1:1', '3:4'" },
                "placeholder": { "type": "string", "enum": ["blur", "color", "skeleton", "none"], "description": "Loading placeholder strategy" }
              }
            },
            "icon": {
              "type": "object",
              "properties": {
                "name": { "type": "string", "description": "Icon name/description, e.g. 'back-arrow', 'more-horizontal'" },
                "size": { "type": "number" },
                "color": { "$ref": "#/$defs/ColorValue" }
              }
            }
          }
        },
        "interaction": {
          "type": "object",
          "description": "Behavioral specs from interaction annotation frames",
          "properties": {
            "source_frame": {
              "type": "string",
              "description": "Name of the interaction spec frame this data came from"
            },
            "behaviors": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "trigger": {
                    "type": "string",
                    "enum": ["click", "hover", "focus", "scroll", "load", "swipe"],
                    "description": "What triggers this behavior"
                  },
                  "action": {
                    "type": "string",
                    "description": "Natural language description of what happens. E.g. 'Navigate to album live page', 'Toggle dropdown open/closed', 'Show loading spinner then fetch next page'"
                  },
                  "target": {
                    "type": "string",
                    "description": "Which element is affected (self, a child name, or a page name)"
                  }
                }
              }
            },
            "states": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "State name: 'default', 'hover', 'active', 'disabled', 'selected', 'loading', 'empty', 'error'"
                  },
                  "style_overrides": {
                    "type": "object",
                    "description": "Style properties that change in this state (same structure as style object, only changed fields)"
                  },
                  "description": {
                    "type": "string",
                    "description": "Natural language description of this state"
                  }
                }
              }
            },
            "transitions": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "property": { "type": "string", "description": "CSS property or 'all'" },
                  "duration_ms": { "type": "number" },
                  "easing": { "type": "string", "description": "e.g. 'ease-out', 'ease-in-out', 'linear', 'cubic-bezier(0.4, 0, 0.2, 1)'" }
                }
              }
            },
            "raw_notes": {
              "type": "string",
              "description": "Original designer annotation text, verbatim. Preserved for context when structured fields don't capture everything."
            }
          }
        },
        "children": {
          "type": "array",
          "description": "Nested child component specs (recursive). Order = render order (first child rendered first / on bottom).",
          "items": { "$ref": "#/$defs/ComponentSpec" }
        },
        "screenshot_path": {
          "type": "string",
          "description": "Relative path to the frame screenshot for visual reference"
        }
      }
    }
  }
}
